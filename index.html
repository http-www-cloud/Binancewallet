<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance Web3 Wallet</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tailwind CSS configuration must come AFTER the Tailwind CDN script -->
    <script>
        tailwind.config = {
            darkMode: 'class', // Enables dark mode based on the 'dark' class on the html element
            theme: {
                extend: {
                    colors: {
                        // Official Binance Dark Mode Colors (from inspection of binance.com)
                        'binance-bg-primary': '#1E2329', // Main background (Binance Black Team Color)
                        'binance-bg-secondary': '#2B3139', // Card/panel background
                        'binance-surface-elevated': '#1A1D22', // Deeper elements, hover states
                        'binance-accent-yellow': '#FCD535', // Primary accent color
                        'binance-text-light': '#FFFFFF', // White text
                        'binance-text-muted': '#848E9C', // Muted gray text
                        'binance-border': '#363A45', // Border color

                        // Specific action colors
                        'binance-green': '#16C784', // Green for gains/buy
                        'binance-red': '#EA3943',   // Red for losses/sell
                        'binance-blue': '#1874D0',  // General action/info blue

                        // For gradients (derived from Binance Web3 Wallet landing page)
                        'binance-gradient-dark-blue': '#0A0A38',
                        'binance-gradient-dark-purple': '#4B0082',
                    },
                    fontFamily: {
                        // Inter font for a clean, modern look
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        // Custom shadow to match Binance's subtle UI elevations
                        'binance-sm': '0 1px 2px 0 rgba(0, 0, 0, 0.05)',
                        'binance-md': '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                        'binance-lg': '0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)',
                    },
                     animation: {
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                        'fade-in-down': 'fadeInDown 0.5s ease-out forwards',
                    },
                    keyframes: {
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                        fadeInDown: {
                            '0%': { opacity: '0', transform: 'translateY(-20px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' },
                        },
                    }
                }
            }
        }
    </script>
    <!-- Link to Inter font from Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel Standalone for in-browser JSX compilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- WalletConnect Web3-Provider & Web3.js for blockchain interactions (used only for simulation) -->
    <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>
    <!-- QRCode.js for generating QR codes -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode.js@1.0.0/qrcode.min.js"></script>

    <!-- PWA Manifest Link -->
</head>
<body className="font-sans antialiased text-binance-text-light bg-binance-bg-primary transition-colors duration-300">

    <!-- Root div where the React app will be mounted -->
    <div id="root"></div>

    <!-- Custom Modal for displaying messages to the user (reused throughout the app) -->
    <div id="message-modal" className="hidden fixed inset-0 z-[1000] bg-black bg-opacity-40 flex items-center justify-center">
        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-lg w-11/12 max-w-sm text-center relative">
            <span className="close-button absolute top-3 right-5 text-binance-text-muted hover:text-binance-text-light text-3xl cursor-pointer" id="close-modal-button">&times;</span>
            <p id="modal-message" className="text-lg text-binance-text-light mt-4"></p>
        </div>
    </div>

    <!-- Main application script, using Babel for JSX processing -->
    <script type="text/babel">
        // Destructuring React hooks and functions for easier use
        const { useState, useEffect, useCallback, createContext, useContext, useRef } = React;

        // --- Global Message Modal Functions ---
        // These functions control the visibility and content of the centralized modal
        const messageModal = document.getElementById('message-modal');
        const modalMessage = document.getElementById('modal-message');
        const closeModalButton = document.getElementById('close-modal-button');

        const showModal = (message) => {
            modalMessage.textContent = message;
            messageModal.classList.remove('hidden');
        };

        const hideModal = () => {
            modalMessage.textContent = ''; // Clear message when hiding
            messageModal.classList.add('hidden');
        };

        closeModalButton.onclick = hideModal;
        window.onclick = (event) => {
            if (event.target === messageModal) {
                hideModal();
            }
        };

     // --- PWA Setup ---
        // Handles the installation prompt and app installation events for PWA
        let deferredPrompt; // Stores the 'beforeinstallprompt' event

        function setupPWA() {
            // Event listener for the 'beforeinstallprompt' event, which is fired by the browser
            // before it displays the PWA installation prompt.
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault(); // Prevents the default browser prompt
                deferredPrompt = e; // Stores the event for later use
                console.log('beforeinstallprompt fired, deferredPrompt stored.');
            });

            // Event listener for when the PWA is successfully installed.
            window.addEventListener('appinstalled', () => {
                console.log('PWA was installed!');
                // showModal('Binance Web3 Wallet PWA installed successfully!'); // Uncomment if you want a modal confirmation
                deferredPrompt = null; // Clear deferredPrompt after installation
            });

            // The 'load' event ensures the DOM is fully loaded before creating the manifest.
            window.addEventListener('load', () => {
                // Dynamically creates the Web App Manifest object.
                const manifestContent = {
                    name: 'Binance Web3 Wallet',
                    short_name: 'BinanceWallet',
                    description: 'Your secure crypto wallet powered by Binance',
                    theme_color: '#1E2329', // Theme color for the PWA
                    background_color: '#1E2329', // Background color for the PWA splash screen
                    display: 'standalone', // Makes the app run in standalone mode
                    scope: '/', // Scope of the PWA
                    start_url: '/', // Starting URL when the PWA is launched
                    icons: [
                        {
                  
                            src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAZlBMVEUzMzPwuQv1vQkrLjQuMDPXpxLyuwonLDQjKTQ8OTEwMjLirw/uuAtxXilIQS85NzJqWSpBPTBfUS1VSy42NTLoswxaTi0gKDXJnRXTpBJMRC/BlxeJbyUXIzVuXCo/OzFkVCx2YSm395DeAAAFKklEQVR4nO2d63baMBCEARtjTBqSBpoAbdO+/0vWNja+aaV1aoO0O9/f4HM80Y52dbG0WAAAAAAAAAAAAAAAAAAAAAAAAABfI0uzR7/CvMSHyyF+9EvMSbRfr9b76NGvMR/xdr1artZbsa0YL3KBy1ziQqjEOCsFFhIzkRKjbSWwkLgV6MV4fxNYSNyLa8VbiC6FBmp06AgsJB5EBWrLg41ESV6M+y1YtaKYQO15UJ4XDSEqK1BjSuBSSAFHhKicQK1qUVpi6DUq6UEpXuyUapTEkAs4qwcleDFyt2DVioEGqiVNDLwYZCsaSzVKYogFHMuDjcTwvOhME4NADcyLbA+2JAbViqNCtJYYUqCO6GTaEsPpbkZ6sJEYihcZpRolMYwC7gsebCSG4EVmqUa2oveBOjpN9CX6njQcA16ORL+HxP/hwUaiz15kpInE+R/wOWkw0kRy/JkkTom+Jg1GiCZP3399Y0j0M1AHiy8mgT82i/Q3Q6KPyzYcDy7fNvkv05eVW6J/XmQU23mIbsrfppxA9a0M53lwU/2aJdEvLzJKtdKDNekLp0f1KFAZpVpHIFOiPwXcuBC9ElSgMmrRZNkTWEhk9Kh+1KicNPH01hfIDVQPvDjegzWs1O+BF98/RnuwhuPFj/c76xkSPx/tr0m0YIGzFZPj8+PbcBE972ytWJVqZhwF3Gr37IEPc4nnHf2aZIhesQZqsjt7ITCX+EoGqiFNdLEkjeT46onAQiIRqMY00YVMGqudPwLJQLV0Mg1Ed+NPiF7Ju5vhazo8WGP0YuJJJ9Ng8CJToFGiTx6sGXiR4cGagRf98mBNz4vsFizotaJvHqzpBOoogT2Jjw/RODKXUnmgJjeBRC9KPdvqURMqRCPi2cmJPz/+mF//VsCRpVp0PhEBeCvgyFIt/Xv6vIvEYsBLtVCVNMgQzb26ojxWBSqZJvJWvs+QuJyyIPvJ0otkqVb2t2Q/WRZwpAfL/vYeExvViN4qwirf0pHkIuzy7zHqv43oLYG4pv5S1z10IH5zhPD8o/7WrBrZmcQZ0RM240iyM4mIme7WOHLeQO0svrDK6tazr62CgEwIZjrF+ZzLNr1ZtVFJvVe3jkrqvYpnPi8OFl9GSBwMr0YUZoPCfK5lG8PMNru4NgyR2cW1YYg8jxeNiy/MVjROczAD1Th6nGPZhpj4ZUk0Do+Zg1xiqmr6pEEuvjB6VEIgSyI5ozp1oFoWX5xeJKepGF60rG1MW6NaF18cE4aWqUanF63rU1MmDcc+GasXrdPFjqThWNeYbt9N5tqEkBdw1GvGZ+uUfxGoZ+o1I9eejTwvTnOMSHpxfrt0JN/y5Hz2RPx3sk/3ytQlnUSh/DaU70MFfamCfKigplFQlyoYWygYHxrH+OyZmiDG+ArmaRTMtSmYL1Uw561g3ULB2pOC9UMFa8AK1vEpBO3FMCN+P434PVHi97WJ35sofn+p+D3C4vd5i9+rL/57C/nfzCj47kn8t2vyvz9U8A2pgu+AFXzLreB7fAVnKig4F0PB2SYKzqdRcMaQgnOiFJz1peC8NgVn7ik4N1HB2ZcKzi9VcAatgnOEFZwFreA8bwVnsis4V1/B3QgK7rdQcEeJgntmFNwVpOC+JwV3dim4d03B3XkK7j9UcIelgntIFdwlq+A+YAV3Oiu4l1vB3eodL0rzYM0tUCWG6JWqRpVQi1KUBZyUUs1MMeoPeETPIT5cJFUyJrJ0osM6AAAAAAAAAAAAAAAAAAAAAAAAKOQfUZliHlImaHIAAAAASUVORK5CYII=',
                            sizes: '192x192',
                            type: 'image/png'
                        },
                        {
                            src: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAZlBMVEUzMzPwuQv1vQkrLjQuMDPXpxLyuwonLDQjKTQ8OTEwMjLirw/uuAtxXilIQS85NzJqWSpBPTBfUS1VSy42NTLoswxaTi0gKDXJnRXTpBJMRC/BlxeJbyUXIzVuXCo/OzFkVCx2YSm395DeAAAFKklEQVR4nO2d63baMBCEARtjTBqSBpoAbdO+/0vWNja+aaV1aoO0O9/f4HM80Y52dbG0WAAAAAAAAAAAAAAAAAAAAAAAAABfI0uzR7/CvMSHyyF+9EvMSbRfr9b76NGvMR/xdr1artZbsa0YL3KBy1ziQqjEOCsFFhIzkRKjbSWwkLgV6MV4fxNYSNyLa8VbiC6FBmp06AgsJB5EBWrLg41ESV6M+y1YtaKYQO15UJ4XDSEqK1BjSuBSSAFHhKicQK1qUVpi6DUq6UEpXuyUapTEkAs4qwcleDFyt2DVioEGqiVNDLwYZCsaSzVKYogFHMuDjcTwvOhME4NADcyLbA+2JAbViqNCtJYYUqCO6GTaEsPpbkZ6sJEYihcZpRolMYwC7gsebCSG4EVmqUa2oveBOjpN9CX6njQcA16ORL+HxP/hwUaiz15kpInE+R/wOWkw0kRy/JkkTom+Jg1GiCZP3399Y0j0M1AHiy8mgT82i/Q3Q6KPyzYcDy7fNvkv05eVW6J/XmQU23mIbsrfppxA9a0M53lwU/2aJdEvLzJKtdKDNekLp0f1KFAZpVpHIFOiPwXcuBC9ElSgMmrRZNkTWEhk9Kh+1KicNPH01hfIDVQPvDjegzWs1O+BF98/RnuwhuPFj/c76xkSPx/tr0m0YIGzFZPj8+PbcBE972ytWJVqZhwF3Gr37IEPc4nnHf2aZIhesQZqsjt7ITCX+EoGqiFNdLEkjeT46onAQiIRqMY00YVMGqudPwLJQLV0Mg1Ed+NPiF7Ju5vhazo8WGP0YuJJJ9Ng8CJToFGiTx6sGXiR4cGagRf98mBNz4vsFizotaJvHqzpBOoogT2Jjw/RODKXUnmgJjeBRC9KPdvqURMqRCPi2cmJPz/+mF//VsCRpVp0PhEBeCvgyFIt/Xv6vIvEYsBLtVCVNMgQzb26ojxWBSqZJvJWvs+QuJyyIPvJ0otkqVb2t2Q/WRZwpAfL/vYeExvViN4qwirf0pHkIuzy7zHqv43oLYG4pv5S1z10IH5zhPD8o/7WrBrZmcQZ0RM240iyM4mIme7WOHLeQO0svrDK6tazr62CgEwIZjrF+ZzLNr1ZtVFJvVe3jkrqvYpnPi8OFl9GSBwMr0YUZoPCfK5lG8PMNru4NgyR2cW1YYg8jxeNiy/MVjROczAD1Th6nGPZhpj4ZUk0Do+Zg1xiqmr6pEEuvjB6VEIgSyI5ozp1oFoWX5xeJKepGF60rG1MW6NaF18cE4aWqUanF63rU1MmDcc+GasXrdPFjqThWNeYbt9N5tqEkBdw1GvGZ+uUfxGoZ+o1I9eejTwvTnOMSHpxfrt0JN/y5Hz2RPx3sk/3ytQlnUSh/DaU70MFfamCfKigplFQlyoYWygYHxrH+OyZmiDG+ArmaRTMtSmYL1Uw561g3ULB2pOC9UMFa8AK1vEpBO3FMCN+P434PVHi97WJ35sofn+p+D3C4vd5i9+rL/57C/nfzCj47kn8t2vyvz9U8A2pgu+AFXzLreB7fAVnKig4F0PB2SYKzqdRcMaQgnOiFJz1peC8NgVn7ik4N1HB2ZcKzi9VcAatgnOEFZwFreA8bwVnsis4V1/B3QgK7rdQcEeJgntmFNwVpOC+JwV3dim4d03B3XkK7j9UcIelgntIFdwlq+A+YAV3Oiu4l1vB3eodL0rzYM0tUCWG6JWqRpVQi1KUBZyUUs1MMeoPeETPIT5cJFUyJrJ0osM6AAAAAAAAAAAAAAAAAAAAAAAAKOQfUZliHlImaHIAAAAASUVORK5CYII=',
                            sizes: '512x512',
                            type: 'image/png',
                            purpose: 'maskable' // Recommended for Android adaptive icons
                        }
                    ],
                    orientation: 'portrait' // Preferred orientation
                };

                // Create a Blob from the manifest content to generate an object URL.
                const manifestBlob = new Blob([JSON.stringify(manifestContent)], { type: 'application/json' });
                const manifestUrl = URL.createObjectURL(manifestBlob);

                // Create a <link> element for the manifest and append it to the document head.
                const link = document.createElement('link');
                link.rel = 'manifest';
                link.href = manifestUrl;
                document.head.appendChild(link);
                console.log('Manifest linked successfully.');

                // A warning about Service Worker registration from 'blob:' URLs, as it might be restricted.
                console.warn("Service Worker registration from 'blob:' URLs is often restricted by browsers in single-file setups. Full PWA offline caching may not work.");
            });
        }
        setupPWA(); // Initialize PWA setup

        // --- User Context for Persistent Login State ---
        // Provides user authentication and wallet connection status throughout the app
        const UserContext = createContext(null);

        // --- Shared Components ---
        // Generic Modal Component
        const Modal = ({ isOpen, onClose, children, title }) => {
            if (!isOpen) return null;

            return (
                <div className="fixed inset-0 z-[1000] bg-black bg-opacity-70 flex items-center justify-center p-4">
                    <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-lg w-full max-w-lg text-center relative border border-binance-border">
                        <button
                            onClick={onClose}
                            className="absolute top-3 right-5 text-binance-text-muted hover:text-binance-text-light text-3xl font-bold transition-colors duration-200"
                            aria-label="Close modal"
                        >
                            &times;
                        </button>
                        {title && <h2 className="text-2xl font-bold text-binance-text-light mb-4">{title}</h2>}
                        {children}
                    </div>
                </div>
            );
        };

        // Component to toggle between light and dark mode
        const DarkModeToggle = ({ isDarkMode, toggleDarkMode }) => (
            <button
                onClick={toggleDarkMode}
                className="p-2 rounded-full bg-binance-bg-secondary text-binance-text-light hover:bg-binance-surface-elevated transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                aria-label="Toggle dark mode"
            >
                {isDarkMode ? (
                    <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 00-.707-.293h-1.414a1 1 0 100 2h1.414a1 1 0 00.707-.293zm-9.192 9.192a1 1 0 00-.707.293l-.707.707a1 1 0 001.414 1.414l.707-.707a1 1 0 00-.293-1.414zM4 10a1 1 0 01-1-1V8a1 1 0 112 0v1a1 1 0 01-1 1zm-4.95-3.536a1 1 0 00.293.707L1.464 8.536a1 1 0 101.414-1.414L2.05 6.464a1 1 0 00-.707-.293zM16 10a1 1 0 01-1-1V8a1 1 0 112 0v1a1 1 0 01-1 1zm4.95-3.536a1 1 0 00-.293.707l-.707.707a1 1 0 00-1.414-1.414l.707-.707a1 1 0 00.707-.293z"></path></svg>
                ) : (
                    <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.04a.75.75 0 010 1.06l-.707.707a.75.75 0 01-1.06 0L14 13.04a6 6 0 11-8.485-8.485.75.75 0 011.06 1.06A4.5 4.5 0 1015.939 12a.75.75 0 011.354.54z"></path></svg>
                )}
            </button>
        );

        // Header component for navigation and branding
        const Header = ({ toggleDarkMode, isDarkMode, navigate, goBack, showBackButton, isLandingPage, showInstallButton, handleInstallClick }) => {
            const { userStatus, setUserStatus } = useContext(UserContext);

            const handleDisconnectWallet = () => {
                showModal('Disconnecting wallet...');
                setTimeout(() => {
                    setUserStatus({ isLoggedIn: false, connectedWalletInfo: null, transactions: [] }); // Clear all user status on disconnect
                    showModal('Wallet disconnected!');
                    hideModal();
                    navigate('landingPage'); // Go back to landing page after disconnect
                }, 1500);
            };

            // Simplified header for landing page vs. full app
            if (isLandingPage) {
                return (
                    <header className="bg-binance-bg-primary fixed top-0 left-0 right-0 z-50 py-4 px-4 sm:px-6">
                        <div className="container mx-auto flex justify-between items-center">
                            <span className="text-xl font-bold text-binance-accent-yellow">Binance Web3 Wallet</span>

                            {showInstallButton && (
                                <button
                                    onClick={handleInstallClick}
                                    className="ml-4 px-4 py-2 text-sm font-semibold bg-binance-accent-yellow text-binance-bg-primary rounded-lg hover:opacity-90 transition-opacity duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                >
                                    Get App
                                </button>
                            )}
                        </div>
                    </header>
                );
            }

            return (
                <header className="bg-binance-bg-secondary shadow-sm dark:shadow-md fixed top-0 left-0 right-0 z-50 transition-colors duration-300">
                    <nav className="container mx-auto px-4 py-3 flex justify-between items-center">
                        {/* Back Button, visible when not on initial landing or home page and history exists */}
                        {showBackButton && (
                            <button
                                onClick={goBack}
                                className="mr-3 p-2 rounded-full bg-binance-surface-elevated text-binance-text-light hover:bg-binance-surface-elevated/70 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                aria-label="Go back"
                            >
                                <svg className="w-5 h-5 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">
                                    <path stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 5H1m0 0 4 4m-4-4 4-4"/>
                                </svg>
                            </button>
                        )}

                     {/* Binance App Title (Now with Icon) */}
          <div className="flex items-center space-x-2 cursor-pointer" onClick={() => navigate('walletPage')}>
              <img
                  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAOEAAADhCAMAAAAJbSJIAAAAZlBMVEUzMzPwuQv1vQkrLjQuMDPXpxLyuwonLDQjKTQ8OTEwMjLirw/uuAtxXilIQS85NzJqWSpBPTBfUS1VSy42NTLoswxaTi0gKDXJnRXTpBJMRC/BlxeJbyUXIzVuXCo/OzFkVCx2YSm395DeAAAFKklEQVR4nO2d63baMBCEARtjTBqSBpoAbdO+/0vWNja+aaV1aoO0O9/f4HM80Y52dbG0WAAAAAAAAAAAAAAAAAAAAAAAAABfI0uzR7/CvMSHyyF+9EvMSbRfr9b76NGvMR/xdr1artZbsa0YL3KBy1ziQqjEOCsFFhIzkRKjbSWwkLgV6MV4fxNYSNyLa8VbiC6FBmp06AgsJB5EBWrLg41ESV6M+y1YtaKYQO15UJ4XDSEqK1BjSuBSSAFHhKicQK1qUVpi6DUq6UEpXuyUapTEkAs4qwcleDFyt2DVioEGqiVNDLwYZCsaSzVKYogFHMuDjcTwvOhME4NADcyLbA+2JAbViqNCtJYYUqCO6GTaEsPpbkZ6sJEYihcZpRolMYwC7gsebCSG4EVmqUa2oveBOjpN9CX6njQcA16ORL+HxP/hwUaiz15kpInE+R/wOWkw0kRy/JkkTom+Jg1GiCZP3399Y0j0M1AHiy8mgT82i/Q3Q6KPyzYcDy7fNvkv05eVW6J/XmQU23mIbsrfppxA9a0M53lwU/2aJdEvLzJKtdKDNekLp0f1KFAZpVpHIFOiPwXcuBC9ElSgMmrRZNkTWEhk9Kh+1KicNPH01hfIDVQPvDjegzWs1O+BF98/RnuwhuPFj/c76xkSPx/tr0m0YIGzFZPj8+PbcBE972ytWJVqZhwF3Gr37IEPc4nnHf2aZIhesQZqsjt7ITCX+EoGqiFNdLEkjeT46onAQiIRqMY00YVMGqudPwLJQLV0Mg1Ed+NPiF7Ju5vhazo8WGP0YuJJJ9Ng8CJToFGiTx6sGXiR4cGagRf98mBNz4vsFizotaJvHqzpBOoogT2Jjw/RODKXUnmgJjeBRC9KPdvqURMqRCPi2cmJPz/+mF//VsCRpVp0PhEBeCvgyFIt/Xv6vIvEYsBLtVCVNMgQzb26ojxWBSqZJvJWvs+QuJyyIPvJ0otkqVb2t2Q/WRZwpAfL/vYeExvViN4qwirf0pHkIuzy7zHqv43oLYG4pv5S1z10IH5zhPD8o/7WrBrZmcQZ0RM240iyM4mIme7WOHLeQO0svrDK6tazr62CgEwIZjrF+ZzLNr1ZtVFJvVe3jkrqvYpnPi8OFl9GSBwMr0YUZoPCfK5lG8PMNru4NgyR2cW1YYg8jxeNiy/MVjROczAD1Th6nGPZhpj4ZUk0Do+Zg1xiqmr6pEEuvjB6VEIgSyI5ozp1oFoWX5xeJKepGF60rG1MW6NaF18cE4aWqUanF63rU1MmDcc+GasXrdPFjqThWNeYbt9N5tqEkBdw1GvGZ+uUfxGoZ+o1I9eejTwvTnOMSHpxfrt0JN/y5Hz2RPx3sk/3ytQlnUSh/DaU70MFfamCfKigplFQlyoYWygYHxrH+OyZmiDG+ArmaRTMtSmYL1Uw561g3ULB2pOC9UMFa8AK1vEpBO3FMCN+P434PVHi97WJ35sofn+p+D3C4vd5i9+rL/57C/nfzCj47kn8t2vyvz9U8A2pgu+AFXzLreB7fAVnKig4F0PB2SYKzqdRcMaQgnOiFJz1peC8NgVn7ik4N1HB2ZcKzi9VcAatgnOEFZwFreA8bwVnsis4V1/B3QgK7rdQcEeJgntmFNwVpOC+JwV3dim4d03B3XkK7j9UcIelgntIFdwlq+A+YAV3Oiu4l1vB3eodL0rzYM0tUCWG6JWqRpVQi1KUBZyUUs1MMeoPeETPIT5cJFUyJrJ0osM6AAAAAAAAAAAAAAAAAAAAAAAAKOQfUZliHlImaHIAAAAASUVORK5CYII="
                  alt="Binance Wallet Logo"
                  className="w-8 h-8 rounded-full"
              />
              <span className="text-xl font-bold text-binance-text-light">Binance</span>
          </div>

                        {/* Main Navigation Links (hidden on small screens, shown for larger screens) */}
                        <div className="hidden md:flex items-center space-x-6">
                            <a href="#" onClick={() => navigate('walletPage')} className="text-binance-text-light hover:text-binance-accent-yellow font-medium transition-colors duration-200">Wallet</a>
                            <a href="#" onClick={() => navigate('marketsPage')} className="text-binance-text-light hover:text-binance-accent-yellow font-medium transition-colors duration-200">Markets</a>
                            <a href="#" onClick={() => navigate('tradePage')} className="text-binance-text-light hover:text-binance-accent-yellow font-medium transition-colors duration-200">Trade</a>
                            <a href="#" onClick={() => navigate('earnPage')} className="text-binance-text-light hover:text-binance-accent-yellow font-medium transition-colors duration-200">Earn</a>
                            <a href="#" onClick={() => navigate('copyTradePage')} className="text-binance-text-light hover:text-binance-accent-yellow font-medium transition-colors duration-200">Copy Trade</a>
                        </div>

                        {/* Action Buttons (Wallet Status, Settings) and Dark Mode Toggle */}
                        <div className="flex items-center space-x-3 sm:space-x-4">
                            {userStatus.connectedWalletInfo ? (
                                <div className="relative group">
                                    <button
                                        onClick={() => navigate('connectedWalletDetails')}
                                        className="px-4 py-2 text-sm font-semibold bg-binance-green text-white rounded-lg hover:bg-green-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-binance-green"
                                    >
                                        Wallet Connected
                                    </button>
                                    <div className="absolute right-0 mt-2 w-48 bg-binance-bg-secondary rounded-lg shadow-xl py-1 hidden group-hover:block transition-all duration-300 origin-top-right border border-binance-border">
                                        <div className="px-4 py-2 text-sm text-binance-text-muted break-all">
                                            {/* Display truncated address */}
                                            {userStatus.connectedWalletInfo.address ?
                                                `${userStatus.connectedWalletInfo.address.substring(0, 6)}...${userStatus.connectedWalletInfo.address.substring(userStatus.connectedWalletInfo.address.length - 4)}`
                                                : 'N/A'}
                                        </div>
                                        <button
                                            onClick={handleDisconnectWallet}
                                            className="block w-full text-left px-4 py-2 text-sm text-binance-red hover:bg-binance-surface-elevated transition-colors duration-200"
                                        >
                                            Disconnect
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <button
                                    onClick={() => navigate('walletConnectPage')}
                                    className="px-4 py-2 text-sm font-semibold bg-binance-accent-yellow text-binance-bg-primary rounded-lg hover:opacity-90 transition-opacity duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                >
                                    Connect Wallet
                                </button>
                            )}

                            {showInstallButton && (
                                <button
                                    onClick={handleInstallClick}
                                    className="hidden md:block px-4 py-2 text-sm font-semibold bg-binance-accent-yellow text-binance-bg-primary rounded-lg hover:opacity-90 transition-opacity duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                >
                                    Get App
                                </button>
                            )}

                            <button
                                onClick={() => navigate('faqPage')}
                                className="px-4 py-2 text-sm font-semibold text-binance-text-light rounded-lg hover:bg-binance-surface-elevated transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                            >
                                Need Help?
                            </button>

                            {userStatus.isLoggedIn && (
                                <button
                                    onClick={() => navigate('settingsPage')}
                                    className="px-4 py-2 text-sm font-semibold text-binance-text-light rounded-lg hover:bg-binance-surface-elevated transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                >
                                    Settings
                                </button>
                            )}
                            <DarkModeToggle isDarkMode={isDarkMode} toggleDarkMode={toggleDarkMode} />
                        </div>
                    </nav>
                </header>
            );
        };

        // Footer component with site navigation and copyright
        const Footer = ({ navigate }) => (
            <footer className="flex justify-around items-center p-4 border-t border-binance-border bg-binance-bg-primary fixed bottom-0 w-full z-10 md:hidden">
                <button onClick={() => navigate('walletPage')} className="flex flex-col items-center text-binance-accent-yellow">
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2l-10 9h2v11h6v-7h4v7h6v-11h2l-10-9z" />
                    </svg>
                    <span className="text-xs mt-1">Wallet</span>
                </button>
                <button onClick={() => navigate('marketsPage')} className="flex flex-col items-center text-binance-text-muted hover:text-binance-accent-yellow">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className="w-6 h-6">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m-4.5 4.5H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.615-2.23-1.666-2.75l-7.218-3.609a1.125 1.125 0 00-1.042 0L3.75 3.358c-1.051.52-1.666 1.615-1.666 2.75V19.5a2.25 2.25 0 002.25 2.25z" />
                    </svg>
                    <span className="text-xs mt-1">Markets</span>
                </button>
                <button onClick={() => navigate('tradePage')} className="flex flex-col items-center text-binance-text-muted hover:text-binance-accent-yellow">
                    <svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M3 6h18M3 12h18m-12 6h12" />
                    </svg>
                    <span className="text-xs mt-1">Trade</span>
                </button>
                <button onClick={() => navigate('copyTradePage')} className="flex flex-col items-center text-binance-text-muted hover:text-binance-accent-yellow">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className="w-6 h-6">
                        <path strokeLinecap="round" strokeLinejoin="round" d="M15.75 6a3.75 3.75 0 11-7.5 0 3.75 3.75 0 017.5 0zM4.501 19.5a7.5 7.5 0 0114.998 0A8.25 8.25 0 0112 21.75a8.25 8.25 0 01-7.499-2.25z" />
                    </svg>
                    <span className="text-xs mt-1">Copy Trade</span>
                </button>
            </footer>
        );

        // --- TradingView Widget Component ---
        // This component dynamically embeds the TradingView Advanced Chart Widget.
        const TradingViewWidget = ({ symbol, interval = "1D", theme = "dark", height = 400 }) => {
            const containerRef = useRef(null);

            useEffect(() => {
                if (document.getElementById(`tradingview-widget-script-${symbol}`)) {
                    return;
                }

                if (containerRef.current) {
                    containerRef.current.innerHTML = '';
                }

                const script = document.createElement('script');
                script.src = 'https://s3.tradingview.com/external-embedding/embed-widget-advanced-chart.js';
                script.type = 'text/javascript';
                script.async = true;
                script.id = `tradingview-widget-script-${symbol}`;

                script.innerHTML = JSON.stringify({
                    "autosize": true,
                    "symbol": symbol,
                    "interval": interval,
                    "timezone": "Etc/UTC",
                    "theme": theme,
                    "style": "1",
                    "locale": "en",
                    "enable_publishing": false,
                    "withdateranges": true,
                    "range": "YTD",
                    "hide_side_toolbar": false,
                    "allow_symbol_change": true,
                    "details": true,
                    "hotlist": true,
                    "calendar": true,
                    "studies": ["Volume@tv-basicstudies"],
                    "container_id": containerRef.current.id || `tradingview-widget-${symbol}-${Math.random().toString(36).substring(2, 9)}`,
                });

                if (!containerRef.current.id) {
                    containerRef.current.id = `tradingview-widget-${symbol}-${Math.random().toString(36).substring(2, 9)}`;
                }

                containerRef.current.appendChild(script);

                return () => {
                    if (containerRef.current) {
                        containerRef.current.innerHTML = '';
                    }
                    const existingScript = document.getElementById(`tradingview-widget-script-${symbol}`);
                    if (existingScript) {
                        existingScript.remove();
                    }
                };
            }, [symbol, interval, theme, height]);

            return (
                <div
                    ref={containerRef}
                    className="tradingview-widget-container"
                    style={{ height: `${height}px`, width: '100%' }}
                >
                    <div className="tradingview-widget-container__widget" style={{ height: 'calc(100% - 32px)', width: '100%' }}></div>
                </div>
            );
        };

        // Component for quick action buttons with no icon
        const QuickActionBtn = ({ text, onClick, icon }) => (
            <button
                onClick={onClick}
                className="flex-1 bg-binance-bg-secondary text-binance-accent-yellow p-3 rounded-lg flex flex-col items-center justify-center space-y-1 hover:bg-binance-surface-elevated transition-colors duration-200"
            >
                {icon}
                <span className="text-sm font-medium">{text}</span>
            </button>
        );

        // Landing Page: Replicated from Binance Web3 Wallet landing page
        const LandingPage = ({ navigate, showInstallButton, handleInstallClick }) => {
            return (
                <div className="min-h-screen bg-binance-bg-primary text-binance-text-light flex items-center justify-center relative overflow-hidden pt-16 pb-20">
                    {/* Background gradients/blobs mimicking Binance's design */}
                    <div className="absolute inset-0 z-0 opacity-40 blur-3xl"
                         style={{
                             background: 'linear-gradient(20deg, var(--tw-colors-binance-gradient-dark-blue) 0%, var(--tw-colors-binance-gradient-dark-purple) 50%, var(--tw-colors-binance-gradient-dark-blue) 100%)',
                         }}>
                    </div>
                    <div className="absolute inset-0 z-0 opacity-30"
                         style={{
                             backgroundImage: 'radial-gradient(ellipse at bottom right, var(--tw-colors-binance-gradient-dark-blue) 0%, transparent 50%)',
                             maskImage: 'linear-gradient(to top, transparent, black 20%)',
                         }}>
                    </div>

                    <section className="container mx-auto px-4 py-16 text-center relative z-10 max-w-4xl">
                        <h1 className="text-4xl sm:text-5xl lg:text-6xl font-extrabold leading-tight mb-4 tracking-tight text-binance-accent-yellow">
                            Binance Web3 Wallet
                        </h1>
                        <p className="text-lg sm:text-xl text-binance-text-muted mb-8 max-w-3xl mx-auto opacity-90">
                            A secure, self-custodial crypto wallet built into the Binance App.
                            Seamlessly explore Web3, manage assets, and trade with ease.
                        </p>
                        <div className="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4">
                            <button
                                onClick={() => navigate('walletConnectPage')}
                                className="w-full sm:w-auto px-8 py-4 bg-binance-accent-yellow text-binance-bg-primary font-semibold text-lg rounded-full shadow-binance-md
                                       hover:opacity-90 transition-opacity duration-300 focus:outline-none focus:ring-4 focus:ring-binance-accent-yellow focus:ring-offset-2 focus:ring-offset-binance-bg-primary"
                            >
                                Connect Wallet
                            </button>
                            {showInstallButton && (
                                <button
                                    onClick={handleInstallClick}
                                    className="w-full sm:w-auto px-8 py-4 border-2 border-binance-accent-yellow text-binance-accent-yellow font-semibold text-lg rounded-full shadow-binance-md
                                       hover:bg-binance-accent-yellow hover:text-binance-bg-primary transition-colors duration-300 focus:outline-none focus:ring-4 focus:ring-binance-accent-yellow focus:ring-offset-2 focus:ring-offset-binance-bg-primary"
                                >
                                    Get App
                                </button>
                            )}
                        </div>
                        {/* Features Section */}
                        <div className="mt-16 text-left">
                            <h2 className="text-3xl font-bold text-binance-text-light mb-8 text-center">Key Features</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                                <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-md border border-binance-border">
                                    <h3 className="text-xl font-semibold text-binance-accent-yellow mb-2">Self-Custody</h3>
                                    <p className="text-binance-text-muted">You hold the keys to your crypto. Complete control, ultimate security.</p>
                                </div>
                                <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-md border border-binance-border">
                                    <h3 className="text-xl font-semibold text-binance-accent-yellow mb-2">Seamless Integration</h3>
                                    <p className="text-binance-text-muted">Built directly into your Binance App for a unified experience.</p>
                                </div>
                                <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-md border border-binance-border">
                                    <h3 className="text-xl font-semibold text-binance-accent-yellow mb-2">Multi-Chain Support</h3>
                                    <p className="text-binance-text-muted">Manage assets across various blockchains, all from one wallet.</p>
                                </div>
                                <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-md border border-binance-border">
                                    <h3 className="text-xl font-semibold text-binance-accent-yellow mb-2">DApp Exploration</h3>
                                    <p className="text-binance-text-muted">Access a world of decentralized applications with ease.</p>
                                </div>
                                <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-md border border-binance-border">
                                    <h3 className="text-xl font-semibold text-binance-accent-yellow mb-2">Secure Transactions</h3>
                                    <p className="text-binance-text-muted">Advanced security measures to protect your every transaction.</p>
                                </div>
                                <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-md border border-binance-border">
                                    <h3 className="text-xl font-semibold text-binance-accent-yellow mb-2">Grow Your Assets</h3>
                                    <p className="text-binance-text-muted">Explore earning opportunities like staking and yield farming.</p>
                                </div>
                            </div>
                        </div>
                        {/* More Info Section */}
                        <div className="mt-16 bg-binance-surface-elevated p-8 rounded-2xl shadow-binance-lg border border-binance-border">
                            <h2 className="text-3xl font-bold text-binance-text-light mb-4 text-center">Why Choose Binance Web3 Wallet?</h2>
                            <p className="text-lg text-binance-text-muted mb-6 text-center">
                                Empower your Web3 journey with a wallet designed for simplicity, security, and performance.
                            </p>
                            <button
                                onClick={() => navigate('faqPage')}
                                className="w-full sm:w-auto px-8 py-4 bg-binance-blue text-white font-semibold text-lg rounded-full shadow-binance-md
                                       hover:bg-blue-600 transition-colors duration-300 focus:outline-none focus:ring-4 focus:ring-binance-blue focus:ring-offset-2 focus:ring-offset-binance-bg-primary"
                            >
                                Learn More in our FAQ
                            </button>
                        </div>
                    </section>
                </div>
            );
        };

        // Wallet Page: The main dashboard after a user logs in and connects wallet
        const WalletPage = ({ navigate, openDepositModal, openWithdrawalModal, isDarkMode }) => {
            const { userStatus } = useContext(UserContext);

            const [marketData, setMarketData] = useState([]);
            const [loadingMarket, setLoadingMarket] = useState(true);
            const [error, setError] = useState(null);

            const fetchMarketData = useCallback(async (perPage = 25) => { // Fetch 25 coins
                setLoadingMarket(true);
                setError(null);
                try {
                    const response = await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=${perPage}&page=1&sparkline=false&price_change_percentage=24h`);
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    setMarketData(data.map(coin => ({
                        id: coin.id,
                        ticker: coin.symbol.toUpperCase(),
                        name: coin.name,
                        currentPrice: coin.current_price,
                        price: `$${coin.current_price.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`,
                        change: coin.price_change_percentage_24h_in_currency ? coin.price_change_percentage_24h_in_currency.toFixed(2) : '0.00',
                        isPositive: coin.price_change_percentage_24h_in_currency >= 0,
                        image: coin.image
                    })));
                } catch (e) {
                    console.error("Failed to fetch market data:", e);
                    setError("Failed to load market data. Please try again later. (CoinGecko API might be rate-limited or unavailable)");
                    // Fallback data for 25 coins
                    setMarketData(Array.from({ length: 25 }, (_, i) => ({
                        id: `coin${i}`,
                        ticker: `TKR${i}`,
                        name: `Coin Name ${i}`,
                        currentPrice: (1000 - i * 10) + (Math.random() * 50),
                        price: `$${((1000 - i * 10) + (Math.random() * 50)).toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`,
                        change: (Math.random() * 4 - 2).toFixed(2),
                        isPositive: Math.random() > 0.5,
                        image: `https://placehold.co/40x40/FFD700/000?text=${i}` // Placeholder images
                    })));
                } finally {
                    setLoadingMarket(false);
                }
            }, []);

            useEffect(() => {
                fetchMarketData(25); // Fetch 25 coins on mount
                const intervalId = setInterval(() => fetchMarketData(25), 60000); // Refresh every minute
                return () => clearInterval(intervalId);
            }, [fetchMarketData]);

            const calculateTotalUSD = useCallback(() => {
                const balances = userStatus.connectedWalletInfo?.detailedBalances || {};
                if (!marketData.length && Object.keys(balances).length === 0) {
                    return 0;
                }
                let total = 0;
                for (const coin of marketData) {
                    const balanceString = balances[coin.ticker] || `0 ${coin.ticker}`;
                    const amount = parseFloat(balanceString.split(' ')[0]);
                    if (!isNaN(amount) && coin.currentPrice) {
                        total += amount * coin.currentPrice;
                    }
                }
                // Directly add USDT balance if it exists and is not already covered by market data
                const usdtBalance = parseFloat((balances.USDT || '0 USDT').split(' ')[0]) || 0;
                if (!marketData.some(coin => coin.ticker === 'USDT')) {
                     total += usdtBalance;
                } else {
                    // If USDT is in market data, ensure its value is correctly added based on its currentPrice (which should be ~1)
                    const usdtMarketData = marketData.find(coin => coin.ticker === 'USDT');
                    if (usdtMarketData) {
                         total += usdtBalance * usdtMarketData.currentPrice;
                    }
                }

                return total;
            }, [userStatus.connectedWalletInfo, marketData]);

            const totalAssetsValue = calculateTotalUSD();

            const PriceUpdateItem = ({ symbol, name, price, change, isPositive, image }) => (
                <div className="flex justify-between items-center py-2 border-b border-binance-border last:border-b-0">
                    <div className="flex items-center space-x-3">
                        {image && <img src={image} alt={`${name} icon`} className="w-6 h-6 rounded-full" />}
                        <div>
                            <p className="font-medium text-binance-text-light">{symbol}</p>
                            <p className="text-xs text-binance-text-muted">{name}</p>
                        </div>
                    </div>
                    <div className="text-right">
                        <p className="font-medium text-binance-text-light">{price}</p>
                        <p className={`text-xs ${isPositive ? 'text-binance-green' : 'text-binance-red'}`}>{isPositive ? '+' : ''}{change}%</p>
                    </div>
                </div>
            );

            const getSimulatedUserAssets = useCallback(() => {
                const baseAssets = [
                    { id: 'binancecoin', ticker: 'BNB', name: 'Binance Coin', icon: 'https://assets.coingecko.com/coins/images/825/large/binance-coin-logo.png' },
                    { id: 'tether', ticker: 'USDT', name: 'Tether', icon: 'https://assets.coingecko.com/coins/images/325/large/Tether-logo.png' },
                    { id: 'bitcoin', ticker: 'BTC', name: 'Bitcoin', icon: 'https://assets.coingecko.com/coins/images/1/large/bitcoin.png' },
                    { id: 'ethereum', ticker: 'ETH', name: 'Ethereum', icon: 'https://assets.coingecko.com/coins/images/279/large/ethereum.png' },
                ];

                const balances = userStatus.connectedWalletInfo?.detailedBalances || {};

                return baseAssets.map(asset => {
                    const detailedBalance = balances[asset.ticker] || `0.00 ${asset.ticker}`;
                    const totalAmount = parseFloat(detailedBalance.split(' ')[0]);
                    const currentPriceData = marketData.find(m => m.ticker === asset.ticker);
                    const usdValue = currentPriceData ? (totalAmount * currentPriceData.currentPrice).toFixed(2) : '0.00';
                    return {
                        ...asset,
                        totalAmount: totalAmount,
                        usdValue: usdValue,
                    };
                });
            }, [userStatus.connectedWalletInfo, marketData]);

            const simulatedUserAssetBalances = userStatus.connectedWalletInfo ? getSimulatedUserAssets() : [];

            const chartTheme = isDarkMode ? "dark" : "light";

            return (
                <div className="min-h-screen pt-16 bg-binance-bg-primary text-binance-text-light transition-colors duration-300">
                    <main className="container mx-auto px-4 py-8 space-y-6">
                        {userStatus.connectedWalletInfo ? (
                            <>
                                {/* Total Assets Card */}
                                <div className="card bg-binance-bg-secondary p-5 rounded-2xl shadow-lg border border-binance-border">
                                    <h2 className="text-sm text-binance-text-muted font-medium">Total Balance</h2>
                                    <p id="totalAssets" className="text-3xl mt-2 text-binance-accent-yellow font-bold">${totalAssetsValue.toFixed(2)}</p>
                                    <p className="text-sm text-binance-text-muted mt-1">
                                        Wallet Address: <span className="font-mono text-binance-text-light break-all">
                                            {userStatus.connectedWalletInfo.address.substring(0, 8)}...{userStatus.connectedWalletInfo.address.substring(userStatus.connectedWalletInfo.address.length - 6)}
                                        </span>
                                    </p>
                                </div>

                                {/* Quick Action Buttons */}
                                <div className="grid grid-cols-2 sm:grid-cols-4 gap-3">
                                    <QuickActionBtn
                                        text={"Send"}
                                        onClick={openWithdrawalModal}
                                        icon={<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>}
                                    />
                                    <QuickActionBtn
                                        text={"Receive"}
                                        onClick={openDepositModal}
                                        icon={<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>}
                                    />
                                    <QuickActionBtn
                                        text={"Convert"}
                                        onClick={() => navigate('convertPage')}
                                        icon={<svg xmlns="http://www.w3.org/2000/svg" className="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" /></svg>}
                                    />
                                    <QuickActionBtn
                                        text={"Swap"}
                                        onClick={() => navigate('swapPage')}
                                        icon={<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className="w-6 h-6"><path strokeLinecap="round" strokeLinejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h18M16.5 3l4.5 4.5m0 0L16.5 12M21 7.5H3" /></svg>}
                                    />
                                </div>

                                {/* Live Price Performance Charts (TradingView Widget) */}
                                <div className="bg-binance-surface-elevated p-5 rounded-xl shadow-lg border border-binance-border">
                                    <h3 className="text-binance-accent-yellow font-bold text-lg mb-3">Live Price Performance</h3>
                                    {loadingMarket ? (
                                        <div className="text-center py-8 text-binance-text-muted">Loading charts...</div>
                                    ) : error ? (
                                        <div className="text-center py-8 text-binance-red">{error}</div>
                                    ) : (
                                        <div className="space-y-4">
                                            <div className="h-64 sm:h-80">
                                                <TradingViewWidget symbol="BINANCE:BTCUSDT" interval="1H" theme={chartTheme} height="100%" />
                                            </div>
                                            <div className="h-64 sm:h-80">
                                                <TradingViewWidget symbol="BINANCE:ETHUSDT" interval="1H" theme={chartTheme} height="100%" />
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* Your Wallet Holdings Section (Summary) */}
                                <div className="card bg-binance-bg-secondary p-5 rounded-2xl shadow-lg border border-binance-border">
                                    <h3 className="text-lg font-semibold mb-3">Your Wallet Holdings</h3>
                                    <ul className="space-y-3">
                                        {simulatedUserAssetBalances.map(asset => (
                                            <li key={asset.ticker} className="flex justify-between items-center">
                                                <div className="flex items-center space-x-3">
                                                    <img src={asset.icon} alt={asset.name} className="w-8 h-8 rounded-full" />
                                                    <div>
                                                        <p className="font-medium text-binance-text-light">{asset.ticker}</p>
                                                        <p className="text-xs text-binance-text-muted">{asset.name}</p>
                                                    </div>
                                                </div>
                                                <div className="text-right">
                                                    <p className="font-medium text-binance-text-light">{asset.totalAmount.toFixed(4)} {asset.ticker}</p>
                                                    <p className="text-xs text-binance-text-muted">${asset.usdValue}</p>
                                                </div>
                                            </li>
                                        ))}
                                    </ul>
                                    <div className="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3 mt-6">
                                        <button
                                            onClick={() => navigate('walletPortfolioPage')}
                                            className="w-full sm:flex-1 px-4 py-2 bg-binance-blue text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors"
                                        >
                                            View Portfolio
                                        </button>
                                        <button
                                            onClick={() => navigate('transactionHistoryPage')}
                                            className="w-full sm:flex-1 px-4 py-2 bg-binance-green text-white font-semibold rounded-lg hover:bg-green-600 transition-colors"
                                        >
                                            Transactions
                                        </button>
                                        <button
                                            onClick={() => navigate('connectedWalletDetails')}
                                            className="w-full sm:flex-1 px-4 py-2 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors"
                                        >
                                            Wallet Details
                                        </button>
                                    </div>
                                </div>

                                {/* Live Coin Prices List (Top 25) */}
                                <div className="bg-binance-bg-secondary p-5 rounded-2xl shadow-lg border border-binance-border">
                                    <h3 className="text-lg font-semibold mb-3">Top 25 Live Coin Prices</h3>
                                    <div className="overflow-x-auto">
                                        <table className="min-w-full divide-y divide-binance-border">
                                            <thead>
                                                <tr>
                                                    <th className="px-4 py-2 text-left text-xs font-medium text-binance-text-muted uppercase tracking-wider">Coin</th>
                                                    <th className="px-4 py-2 text-right text-xs font-medium text-binance-text-muted uppercase tracking-wider">Price</th>
                                                    <th className="px-4 py-2 text-right text-xs font-medium text-binance-text-muted uppercase tracking-wider">24h Change</th>
                                                </tr>
                                            </thead>
                                            <tbody className="divide-y divide-binance-border">
                                                {loadingMarket ? (
                                                    <tr>
                                                        <td colSpan="3" className="px-4 py-4 text-center text-binance-text-muted">Loading coin prices...</td>
                                                    </tr>
                                                ) : error ? (
                                                    <tr>
                                                        <td colSpan="3" className="px-4 py-4 text-center text-binance-red">{error}</td>
                                                    </tr>
                                                ) : (
                                                    marketData.map(coin => (
                                                        <tr key={coin.id}>
                                                            <td className="px-4 py-4 whitespace-nowrap">
                                                                <div className="flex items-center">
                                                                    <img src={coin.image} alt={coin.name} className="w-6 h-6 rounded-full mr-2" />
                                                                    <span className="font-medium text-binance-text-light">{coin.ticker}</span>
                                                                    <span className="ml-2 text-sm text-binance-text-muted hidden sm:inline">{coin.name}</span>
                                                                </div>
                                                            </td>
                                                            <td className="px-4 py-4 whitespace-nowrap text-right text-binance-text-light">{coin.price}</td>
                                                            <td className={`px-4 py-4 whitespace-nowrap text-right ${coin.isPositive ? 'text-binance-green' : 'text-binance-red'}`}>
                                                                {coin.isPositive ? '+' : ''}{coin.change}%
                                                            </td>
                                                        </tr>
                                                    ))
                                                )}
                                            </tbody>
                                        </table>
                                    </div>
                                </div>

                                {/* Discover DApps Section - Removed Icons, only labels */}
                                <div className="bg-binance-bg-secondary p-5 rounded-2xl shadow-lg border border-binance-border">
                                    <h3 className="text-lg font-semibold mb-3">Discover DApps</h3>
                                    <p className="text-sm text-binance-text-muted mb-4">
                                        Explore decentralized applications across various networks.
                                    </p>
                                    <div className="grid grid-cols-2 sm:grid-cols-3 gap-3">
                                        <button onClick={() => navigate('dappDetailsPage', { dapp: 'PancakeSwap' })} className="flex flex-col items-center p-3 bg-binance-surface-elevated rounded-lg hover:bg-binance-surface-elevated/70 transition-colors">
                                            {/* Removed img tag */}
                                            <span className="text-sm text-binance-text-light font-medium">PancakeSwap</span>
                                        </button>
                                        <button onClick={() => navigate('dappDetailsPage', { dapp: 'OpenSea' })} className="flex flex-col items-center p-3 bg-binance-surface-elevated rounded-lg hover:bg-binance-surface-elevated/70 transition-colors">
                                            {/* Removed img tag */}
                                            <span className="text-sm text-binance-text-light font-medium">OpenSea</span>
                                        </button>
                                        <button onClick={() => navigate('dappDetailsPage', { dapp: 'Aave' })} className="flex flex-col items-center p-3 bg-binance-surface-elevated rounded-lg hover:bg-binance-surface-elevated/70 transition-colors">
                                            {/* Removed img tag */}
                                            <span className="text-sm text-binance-text-light font-medium">Aave</span>
                                        </button>
                                    </div>
                                    <button
                                        onClick={() => navigate('dappsPage')}
                                        className="w-full mt-4 px-4 py-2 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-colors"
                                    >
                                        Explore All DApps
                                    </button>
                                </div>

                                {/* Earn Section */}
                                <div className="card bg-binance-bg-secondary p-5 rounded-2xl shadow-lg border border-binance-border">
                                    <h3 className="text-lg font-semibold mb-3">Earn More Crypto</h3>
                                    <p className="text-sm text-binance-text-muted mb-4">
                                        Grow your crypto assets with staking, savings, and more.
                                    </p>
                                    <div className="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-3">
                                        <button
                                            onClick={() => navigate('earnPage')}
                                            className="w-full sm:flex-1 px-4 py-2 bg-binance-green text-white font-semibold rounded-lg hover:bg-green-600 transition-colors"
                                        >
                                            View Earn Products
                                        </button>
                                        <button
                                            onClick={() => navigate('stakePage')}
                                            className="w-full sm:flex-1 px-4 py-2 bg-binance-blue text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors"
                                        >
                                            Stake Now
                                        </button>
                                    </div>
                                </div>
                            </>
                        ) : (
                            <div className="text-center py-16">
                                <p className="text-xl text-binance-text-muted mb-6">Connect your wallet to view your wallet!</p>
                                <button
                                    onClick={() => navigate('walletConnectPage')}
                                    className="px-8 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200"
                                >
                                    Connect Wallet
                                </button>
                            </div>
                        )}
                    </main>
                </div>
            );
        };

        // Trade Page (Market trends removed)
        const TradePage = ({ navigate, isDarkMode }) => {
            return (
                <div className="min-h-screen bg-binance-bg-primary pt-16 transition-colors duration-300">
                    <div className="container mx-auto px-4 py-8">
                        <h1 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Trade Crypto</h1>

                        {/* Trading Interface Simulation */}
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg mb-8 border border-binance-border">
                            <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                                {/* Order Form */}
                                <div className="bg-binance-surface-elevated p-4 rounded-lg border border-binance-border">
                                    <h2 className="text-xl font-bold text-binance-text-light mb-4">Place Order</h2>
                                    <div className="flex mb-4">
                                        <button className="flex-1 py-2 rounded-l-lg bg-binance-green text-white font-semibold hover:bg-green-600 transition-colors">Buy</button>
                                        <button className="flex-1 py-2 rounded-r-lg bg-binance-red text-white font-semibold hover:bg-red-600 transition-colors">Sell</button>
                                    </div>
                                    <div className="mb-4">
                                        <label htmlFor="price" className="block text-binance-text-muted text-sm font-medium mb-2">Price (USDT)</label>
                                        <input type="number" id="price" placeholder="Market" className="w-full px-4 py-3 rounded-lg bg-binance-bg-primary text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow" />
                                    </div>
                                    <div className="mb-4">
                                        <label htmlFor="amount" className="block text-binance-text-muted text-sm font-medium mb-2">Amount (BTC)</label>
                                        <input type="number" id="amount" placeholder="0.00" className="w-full px-4 py-3 rounded-lg bg-binance-bg-primary text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow" />
                                    </div>
                                    <button onClick={() => showModal('Simulating trade execution.')} className="w-full px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200">
                                        Buy BTC
                                    </button>
                                </div>
                                {/* Trading Chart Section (still needed for trade page, but not "market trends") */}
                                <div>
                                    <h2 className="text-2xl font-bold text-binance-text-light mb-4">BTC/USDT Chart</h2>
                                    <TradingViewWidget symbol="BINANCE:BTCUSDT" interval="1H" theme={isDarkMode ? "dark" : "light"} height={300} />
                                </div>
                            </div>
                        </div>

                        {/* Order Book / Recent Trades (placeholder) */}
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg border border-binance-border">
                            <h2 className="text-2xl font-bold text-binance-text-light mb-4">Order Book / Recent Trades</h2>
                            <p className="text-binance-text-muted text-center py-8">
                                Order book and recent trades would be displayed here in a real application.
                            </p>
                        </div>
                    </div>
                </div>
            );
        };

        // Earn Page - with simulated chart
        const EarnPage = ({ navigate, isDarkMode }) => {
             const chartTheme = isDarkMode ? "dark" : "light";

            return (
                <div className="min-h-screen bg-binance-bg-primary pt-16 transition-colors duration-300">
                    <div className="container mx-auto px-4 py-8">
                        <h1 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Earn Passive Income</h1>

                        {/* Earn Products Overview */}
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg mb-8 border border-binance-border">
                            <h2 className="text-2xl font-bold text-binance-text-light mb-4">Popular Earn Products</h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {/* Staking Card */}
                                <div className="bg-binance-surface-elevated p-5 rounded-lg border border-binance-border flex items-center justify-between">
                                    <div>
                                        <h3 className="text-xl font-semibold text-binance-text-light">Staking</h3>
                                        <p className="text-binance-text-muted">Earn rewards by holding crypto.</p>
                                    </div>
                                    <button onClick={() => navigate('stakePage')} className="px-4 py-2 bg-binance-green text-white rounded-lg hover:bg-green-600 transition-colors">Start Earning</button>
                                </div>
                                {/* Flexible Savings Card */}
                                <div className="bg-binance-surface-elevated p-5 rounded-lg border border-binance-border flex items-center justify-between">
                                    <div>
                                        <h3 className="text-xl font-semibold text-binance-text-light">Flexible Savings</h3>
                                        <p className="text-binance-text-muted">High flexibility, daily earnings.</p>
                                    </div>
                                    <button onClick={() => showModal('Exploring flexible savings.')} className="px-4 py-2 bg-binance-blue text-white rounded-lg hover:bg-blue-600 transition-colors">Deposit Now</button>
                                </div>
                            </div>
                        </div>

                        {/* Earn Performance Chart (TradingView Widget for BNB staking APY simulation - using a crypto chart) */}
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg mb-8 border border-binance-border">
                            <h2 className="text-2xl font-bold text-binance-text-light mb-4">BNB Staking APY (Simulated via BNB/USDT chart)</h2>
                            <TradingViewWidget symbol="BINANCE:BNBUSDT" interval="1D" theme={chartTheme} height={300} />
                        </div>

                        {/* More Earn Products (placeholder) */}
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg border border-binance-border">
                            <h2 className="text-2xl font-bold text-binance-text-light mb-4">Other Earn Products</h2>
                            <p className="text-binance-text-muted text-center py-8">
                                More diversified earning products like Launchpool, Liquid Swap would be here.
                            </p>
                            <div className="text-center">
                                <button onClick={() => navigate('earnPage')} className="px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200">
                                    View All Products
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- New: Convert Page ---
        const ConvertPage = ({ navigate, isDarkMode }) => {
            const chartTheme = isDarkMode ? "dark" : "light";
            const [fromAmount, setFromAmount] = useState('');
            const [toAmount, setToAmount] = useState('');
            const [fromAsset, setFromAsset] = useState('BTC');
            const [toAsset, setToAsset] = useState('USDT');
            const [isLoading, setIsLoading] = useState(false);

            // Simple simulated conversion rate
            const getConversionRate = (from, to) => {
                if (from === 'BTC' && to === 'USDT') return 70000;
                if (from === 'USDT' && to === 'BTC') return 1 / 70000;
                if (from === 'ETH' && to === 'USDT') return 3500;
                if (from === 'USDT' && to === 'ETH') return 1 / 3500;
                if (from === 'BNB' && to === 'USDT') return 600;
                if (from === 'USDT' && to === 'BNB') return 1 / 600;
                return 1; // Fallback for same asset or unsupported pairs
            };

            useEffect(() => {
                if (fromAmount) {
                    const rate = getConversionRate(fromAsset, toAsset);
                    setToAmount((parseFloat(fromAmount) * rate).toFixed(6));
                } else {
                    setToAmount('');
                }
            }, [fromAmount, fromAsset, toAsset]);

            const handleConvert = (e) => {
                e.preventDefault();
                setIsLoading(true);
                showModal(`Converting ${fromAmount} ${fromAsset} to ${toAmount} ${toAsset}...`);

                setTimeout(() => {
                    setIsLoading(false);
                    hideModal();
                    showModal('Conversion simulated successfully!');
                    // In a real app, update user balances here
                    setFromAmount('');
                    setToAmount('');
                }, 3000);
            };

            return (
                <div className="min-h-screen bg-binance-bg-primary pt-16 transition-colors duration-300">
                    <div className="container mx-auto px-4 py-8">
                        <h1 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Convert Crypto</h1>

                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg mb-8 border border-binance-border max-w-lg mx-auto">
                            <p className="text-binance-text-muted mb-6 text-center">Instantly convert between cryptocurrencies.</p>
                            <form onSubmit={handleConvert}>
                                <div className="mb-4">
                                    <label htmlFor="fromAmount" className="block text-binance-text-light text-sm font-medium mb-2">From</label>
                                    <div className="flex rounded-lg border border-binance-border focus-within:ring-2 focus-within:ring-binance-accent-yellow bg-binance-surface-elevated">
                                        <input
                                            type="number"
                                            id="fromAmount"
                                            className="flex-1 px-4 py-3 bg-transparent text-binance-text-light focus:outline-none"
                                            placeholder="Amount"
                                            value={fromAmount}
                                            onChange={(e) => setFromAmount(e.target.value)}
                                            min="0"
                                            step="any"
                                            required
                                            disabled={isLoading}
                                        />
                                        <select
                                            className="p-3 bg-binance-bg-primary text-binance-text-light rounded-r-lg border-l border-binance-border focus:outline-none"
                                            value={fromAsset}
                                            onChange={(e) => setFromAsset(e.target.value)}
                                            disabled={isLoading}
                                        >
                                            <option value="BTC">BTC</option>
                                            <option value="ETH">ETH</option>
                                            <option value="BNB">BNB</option>
                                            <option value="USDT">USDT</option>
                                        </select>
                                    </div>
                                </div>

                                <div className="text-center my-4">
                                    <button
                                        type="button"
                                        onClick={() => {
                                            // Swap assets
                                            const tempAsset = fromAsset;
                                            setFromAsset(toAsset);
                                            setToAsset(tempAsset);
                                        }}
                                        className="p-2 rounded-full bg-binance-surface-elevated text-binance-text-light hover:bg-binance-surface-elevated/70 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                        aria-label="Swap assets"
                                        disabled={isLoading}
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className="w-6 h-6">
                                            <path strokeLinecap="round" strokeLinejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h18M16.5 3l4.5 4.5m0 0L16.5 12M21 7.5H3" />
                                        </svg>
                                    </button>
                                </div>

                                <div className="mb-6">
                                    <label htmlFor="toAmount" className="block text-binance-text-light text-sm font-medium mb-2">To</label>
                                    <div className="flex rounded-lg border border-binance-border bg-binance-surface-elevated">
                                        <input
                                            type="number"
                                            id="toAmount"
                                            className="flex-1 px-4 py-3 bg-transparent text-binance-text-muted focus:outline-none"
                                            placeholder="Receivable amount"
                                            value={toAmount}
                                            readOnly
                                            disabled
                                        />
                                        <select
                                            className="p-3 bg-binance-bg-primary text-binance-text-light rounded-r-lg border-l border-binance-border focus:outline-none"
                                            value={toAsset}
                                            onChange={(e) => setToAsset(e.target.value)}
                                            disabled={isLoading}
                                        >
                                            <option value="USDT">USDT</option>
                                            <option value="BTC">BTC</option>
                                            <option value="ETH">ETH</option>
                                            <option value="BNB">BNB</option>
                                        </select>
                                    </div>
                                </div>

                                <button
                                    type="submit"
                                    className="w-full px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg shadow-binance-md hover:opacity-90 transition-opacity duration-200"
                                    disabled={isLoading || !fromAmount}
                                >
                                    {isLoading ? (
                                        <span className="flex items-center justify-center">
                                            <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-binance-bg-primary mr-3"></div>
                                            Converting...
                                        </span>
                                    ) : 'Convert Now'}
                                </button>
                            </form>
                        </div>
                        {/* TradingView Mini Chart for Price Trend */}
                        <div className="bg-binance-bg-secondary p-4 rounded-xl shadow-lg border border-binance-border mt-8">
                            <h3 className="text-binance-accent-yellow font-bold text-lg mb-3">BTC/USDT Price Trend</h3>
                            <TradingViewWidget symbol="BINANCE:BTCUSDT" interval="1D" theme={chartTheme} height={200} />
                        </div>
                    </div>
                </div>
            );
        };

        // --- New: Swap Page ---
        const SwapPage = ({ navigate, isDarkMode }) => {
            const chartTheme = isDarkMode ? "dark" : "light";
            const [fromAmount, setFromAmount] = useState('');
            const [toAmount, setToAmount] = useState('');
            const [fromAsset, setFromAsset] = useState('ETH');
            const [toAsset, setToAsset] = useState('BNB');
            const [isLoading, setIsLoading] = useState(false);

            // Simple simulated swap rate
            const getSwapRate = (from, to) => {
                if (from === 'ETH' && to === 'BNB') return 0.1; // 1 ETH = 0.1 BNB (example)
                if (from === 'BNB' && to === 'ETH') return 10;   // 1 BNB = 10 ETH (example)
                // Add more simulated rates as needed
                return 1;
            };

            useEffect(() => {
                if (fromAmount) {
                    const rate = getSwapRate(fromAsset, toAsset);
                    setToAmount((parseFloat(fromAmount) * rate).toFixed(6));
                } else {
                    setToAmount('');
                }
            }, [fromAmount, fromAsset, toAsset]);

            const handleSwap = (e) => {
                e.preventDefault();
                setIsLoading(true);
                showModal(`Swapping ${fromAmount} ${fromAsset} for ${toAmount} ${toAsset}...`);

                setTimeout(() => {
                    setIsLoading(false);
                    hideModal();
                    showModal('Swap simulated successfully!');
                    // In a real app, update user balances here
                    setFromAmount('');
                    setToAmount('');
                }, 3000);
            };

            return (
                <div className="min-h-screen bg-binance-bg-primary pt-16 transition-colors duration-300">
                    <div className="container mx-auto px-4 py-8">
                        <h1 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Swap Crypto</h1>

                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg mb-8 border border-binance-border max-w-lg mx-auto">
                            <p className="text-binance-text-muted mb-6 text-center">Exchange one cryptocurrency for another.</p>
                            <form onSubmit={handleSwap}>
                                <div className="mb-4">
                                    <label htmlFor="fromSwapAmount" className="block text-binance-text-light text-sm font-medium mb-2">You Pay</label>
                                    <div className="flex rounded-lg border border-binance-border focus-within:ring-2 focus-within:ring-binance-accent-yellow bg-binance-surface-elevated">
                                        <input
                                            type="number"
                                            id="fromSwapAmount"
                                            className="flex-1 px-4 py-3 bg-transparent text-binance-text-light focus:outline-none"
                                            placeholder="Amount"
                                            value={fromAmount}
                                            onChange={(e) => setFromAmount(e.target.value)}
                                            min="0"
                                            step="any"
                                            required
                                            disabled={isLoading}
                                        />
                                        <select
                                            className="p-3 bg-binance-bg-primary text-binance-text-light rounded-r-lg border-l border-binance-border focus:outline-none"
                                            value={fromAsset}
                                            onChange={(e) => setFromAsset(e.target.value)}
                                            disabled={isLoading}
                                        >
                                            <option value="ETH">ETH</option>
                                            <option value="BNB">BNB</option>
                                            <option value="BTC">BTC</option>
                                            <option value="USDT">USDT</option>
                                        </select>
                                    </div>
                                </div>

                                <div className="text-center my-4">
                                    <button
                                        type="button"
                                        onClick={() => {
                                            const tempAsset = fromAsset;
                                            setFromAsset(toAsset);
                                            setToAsset(tempAsset);
                                        }}
                                        className="p-2 rounded-full bg-binance-surface-elevated text-binance-text-light hover:bg-binance-surface-elevated/70 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                        aria-label="Swap assets"
                                        disabled={isLoading}
                                    >
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" strokeWidth="1.5" stroke="currentColor" className="w-6 h-6">
                                            <path strokeLinecap="round" strokeLinejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h18M16.5 3l4.5 4.5m0 0L16.5 12M21 7.5H3" />
                                        </svg>
                                    </button>
                                </div>

                                <div className="mb-6">
                                    <label htmlFor="toSwapAmount" className="block text-binance-text-light text-sm font-medium mb-2">You Receive</label>
                                    <div className="flex rounded-lg border border-binance-border bg-binance-surface-elevated">
                                        <input
                                            type="number"
                                            id="toSwapAmount"
                                            className="flex-1 px-4 py-3 bg-transparent text-binance-text-muted focus:outline-none"
                                            placeholder="Receivable amount"
                                            value={toAmount}
                                            readOnly
                                            disabled
                                        />
                                        <select
                                            className="p-3 bg-binance-bg-primary text-binance-text-light rounded-r-lg border-l border-binance-border focus:outline-none"
                                            value={toAsset}
                                            onChange={(e) => setToAsset(e.target.value)}
                                            disabled={isLoading}
                                        >
                                            <option value="BNB">BNB</option>
                                            <option value="ETH">ETH</option>
                                            <option value="USDT">USDT</option>
                                            <option value="BTC">BTC</option>
                                        </select>
                                    </div>
                                </div>

                                <button
                                    type="submit"
                                    className="w-full px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg shadow-binance-md hover:opacity-90 transition-opacity duration-200"
                                    disabled={isLoading || !fromAmount}
                                >
                                    {isLoading ? (
                                        <span className="flex items-center justify-center">
                                            <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-binance-bg-primary mr-3"></div>
                                            Swapping...
                                        </span>
                                    ) : 'Swap Now'}
                                </button>
                            </form>
                        </div>

                        {/* TradingView Mini Chart for Swap Pair Price Trend */}
                        <div className="bg-binance-bg-secondary p-4 rounded-xl shadow-lg border border-binance-border mt-8">
                            <h3 className="text-binance-accent-yellow font-bold text-lg mb-3">ETH/BNB Price Trend</h3>
                            <TradingViewWidget symbol="BINANCE:ETHBNB" interval="1D" theme={chartTheme} height={200} />
                        </div>
                    </div>
                </div>
            );
        };

        // Login Page: User authentication form (Kept for completeness, but not primary login path)
        const LoginPage = ({ navigate, setUserStatus }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const handleLogin = (e) => {
                e.preventDefault();
                setIsLoading(true);
                showModal('Logging in...');

                setTimeout(() => {
                    setIsLoading(false);
                    hideModal();
                    setUserStatus(prevStatus => ({ ...prevStatus, isLoggedIn: true }));
                    showModal('Login successful! You can now connect your wallet.');
                    navigate('walletPage'); // Redirect to wallet page after login
                }, 3000);
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 transition-colors duration-300 p-4">
                    <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/12 max-w-md border border-binance-border">
                        <h2 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Log In</h2>
                        <form onSubmit={handleLogin}>
                            <div className="mb-4">
                                <label htmlFor="email" className="block text-binance-text-light text-sm font-medium mb-2">Email / Mobile</label>
                                <input
                                    type="text"
                                    id="email"
                                    className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                    placeholder="Enter email or mobile"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />
                            </div>
                            <div className="mb-6">
                                <label htmlFor="password" className="block text-binance-text-light text-sm font-medium mb-2">Password</label>
                                <input
                                    type="password"
                                    id="password"
                                    className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                    placeholder="Enter password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>
                            <button
                                type="submit"
                                className="w-full px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg shadow-binance-md hover:opacity-90 transition-opacity duration-200 focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                disabled={isLoading}
                            >
                                {isLoading ? (
                                    <span className="flex items-center justify-center">
                                        <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-binance-bg-primary mr-3"></div>
                                        Logging In...
                                    </span>
                                ) : 'Log In'}
                            </button>
                            <p className="text-center text-sm text-binance-text-muted mt-4">
                                Don't have an account? <a href="#" onClick={(e) => { e.preventDefault(); navigate('registerPage'); }} className="text-binance-accent-yellow hover:underline">Register Now</a>
                            </p>
                        </form>
                    </div>
                </div>
            );
        };

        // NEW Wallet Connect Page (based on provided HTML)
        const WalletConnectPage = ({ navigate, setUserStatus }) => {
            const { userStatus } = useContext(UserContext);
            const [activeSection, setActiveSection] = useState('walletconnect');
            const [walletConnectStatus, setWalletConnectStatus] = useState("Connect your Ethereum wallet via WalletConnect.");
            const [isWalletConnectLoading, setIsWalletConnectLoading] = useState(false);
            const [isManualLoading, setIsManualLoading] = useState(false);

            const [selectedNetworkId, setSelectedNetworkId] = useState('');
            const [manualAddressInput, setManualAddressInput] = useState('');
            const [manualBalanceDisplay, setManualBalanceDisplay] = useState('N/A');
            const [manualNetworkDisplay, setManualNetworkDisplay] = useState('');
            const [manualAddressDisplay, setManualAddressDisplay] = useState('');

            // State for dynamically showing wallet connect details after successful connection
            const [showWalletConnectInfo, setShowWalletConnectInfo] = useState(false);
            const [connectedWalletConnectAddress, setConnectedWalletConnectAddress] = useState('');

            const manualWalletRef = useRef(null); // Ref for manual connection info section
            const walletConnectRef = useRef(null); // Ref for WalletConnect info section

            // Expanded Networks List from provided HTML
            const networks = [
                { id: 'btc', name: 'Bitcoin (BTC)', type: 'non-evm', symbol: 'BTC', api: 'https://api.blockcypher.com/v1/btc/main/addrs/', explorerUrl: 'https://blockchair.com/bitcoin/address/' },
                { id: 'eth-erc20', name: 'Ethereum (ETH ERC20)', type: 'evm', symbol: 'ETH', rpc: 'https://mainnet.infura.io/v3/c35d1ef971da479b918c9900134867d4', explorerUrl: 'https://etherscan.io/address/' }, // Your Infura ID integrated here
                { id: 'bnb-bep20', name: 'BNB Smart Chain (BSC BEP20)', type: 'evm', symbol: 'BNB', rpc: `https://rpc.ankr.com/bsc/${'0338f3b98ad211aef5de661cba3f0ead0981460048cfabeee506cdd58a298204'}`, explorerUrl: 'https://bscscan.com/address/' }, // Updated RPC endpoint to use Ankr with provided API key
                { id: 'tron-trc20', name: 'TRON (TRX TRC20)', type: 'non-evm', symbol: 'TRX', api: 'https://api.trongrid.io/wallet/getaccount', explorerUrl: 'https://tronscan.org/#/address/' },
                { id: 'sol', name: 'Solana (SOL)', type: 'non-evm', symbol: 'SOL', rpc: 'https://api.mainnet-beta.solana.com', explorerUrl: 'https://solscan.io/address/' },
                { id: 'polygon', name: 'Polygon (MATIC)', type: 'evm', symbol: 'MATIC', rpc: 'https://polygon-rpc.com/', explorerUrl: 'https://polygonscan.com/address/' },
                { id: 'avalanche', name: 'Avalanche C-Chain (AVAX)', type: 'evm', symbol: 'AVAX', rpc: 'https://api.avax.network/ext/bc/C/rpc', explorerUrl: 'https://snowtrace.io/address/' },
                { id: 'arbitrum', name: 'Arbitrum One (ARB)', type: 'evm', symbol: 'ETH', rpc: 'https://arb1.arbitrum.io/rpc', explorerUrl: 'https://arbiscan.io/address/' },
                { id: 'optimism', name: 'Optimism (OP)', type: 'evm', symbol: 'ETH', rpc: 'https://mainnet.optimism.io', explorerUrl: 'https://optimistic.etherscan.io/address/' },
                { id: 'fantom', name: 'Fantom (FTM)', type: 'evm', symbol: 'FTM', rpc: 'https://rpc.ftm.tools/', explorerUrl: 'https://ftmscan.com/address/' },
                { id: 'polkadot', name: 'Polkadot (DOT)', type: 'non-evm', symbol: 'DOT', api: 'N/A', explorerUrl: 'https://polkadot.subscan.io/account/' }, // Subscan is common for Polkadot
                { id: 'cosmos', name: 'Cosmos (ATOM)', type: 'non-evm', symbol: 'ATOM', api: 'N/A', explorerUrl: 'https://www.mintscan.io/cosmos/account/' }, // Mintscan is common for Cosmos
                { id: 'cardano', name: 'Cardano (ADA)', type: 'non-evm', symbol: 'ADA', api: 'N/A', explorerUrl: 'https://explorer.cardano.org/en/address/' },
                { id: 'xrp', name: 'XRP Ledger (XRP)', type: 'non-evm', symbol: 'XRP', api: 'N/A', explorerUrl: 'https://xrpscan.com/account/' },
                { id: 'near', name: 'Near Protocol (NEAR)', type: 'non-evm', symbol: 'NEAR', api: 'N/A', explorerUrl: 'https://explorer.near.org/accounts/' }
            ];

            // Handle common logic for setting connected wallet info and navigating
            const completeConnection = useCallback(async (type, address, networkName) => {
                // Ensure user is logged in (simulated if not)
                if (!userStatus.isLoggedIn) {
                    setUserStatus(prevStatus => ({ ...prevStatus, isLoggedIn: true }));
                }

                // Simulate fetching balances
                await new Promise(resolve => setTimeout(resolve, 500)); // Short delay for UI update

                // Assign default starting balances
                const simulatedBalances = {
                    BNB: `0.00 BNB`,
                    ETH: `0.00 ETH`,
                    BTC: `0.00 BTC`,
                    USDT: `5678.78 USDT`
                };

                // If manual connection provided a balance, use it for the primary asset of that network
                const networkSymbol = networks.find(n => n.name === networkName)?.symbol;
                if (networkSymbol && manualBalanceDisplay !== 'N/A' && manualBalanceDisplay !== 'Fetching...' && manualBalanceDisplay !== 'Error' && manualBalanceDisplay.includes(networkSymbol)) {
                    simulatedBalances[networkSymbol] = manualBalanceDisplay;
                }

                setUserStatus(prevStatus => ({
                    ...prevStatus,
                    isLoggedIn: true,
                    connectedWalletInfo: {
                        address: address,
                        balance: simulatedBalances.USDT, // Primary balance for overview (can be dynamically set based on network)
                        network: networkName,
                        type: type,
                        detailedBalances: simulatedBalances // All simulated balances
                    }
                }));

                hideModal(); // Hide any current modal
                showModal(`Successfully connected to ${networkName} with address ${address.substring(0,6)}...${address.substring(address.length - 4)}`);
                // IMPORTANT: Navigate directly to the walletPage (dashboard) as requested
                navigate('walletPage');
            }, [userStatus.isLoggedIn, setUserStatus, navigate, manualBalanceDisplay]);

            const handleConnectWallet = async () => {
                setIsWalletConnectLoading(true);
                setWalletConnectStatus("Connecting...");
                setShowWalletConnectInfo(false); // Hide previous info
                setConnectedWalletConnectAddress(''); // Clear previous address

                try {
                    const provider = new WalletConnectProvider.default({
                        projectId: "cedd3cec8430b2990ce3fe466ecb1a29", // Your WalletConnect Project ID
                        chains: [1], // Target Ethereum Mainnet (Chain ID 1)
                        infuraId: "c35d1ef971da479b918c9900134867d4", // Your Infura ID
                        showQrModal: true
                    });

                    await provider.enable();
                    const web3 = new Web3(provider);
                    const accounts = await web3.eth.getAccounts();

                    if (accounts.length > 0) {
                        const connectedAccount = accounts[0];
                        setWalletConnectStatus(`You're connected!`);
                        setConnectedWalletConnectAddress(connectedAccount);
                        setShowWalletConnectInfo(true);
                        await completeConnection('walletconnect', connectedAccount, 'Ethereum Mainnet');
                    } else {
                        showModal("No accounts found. Please try connecting again.");
                        setWalletConnectStatus("Failed to connect wallet.");
                        setShowWalletConnectInfo(false);
                    }
                } catch (error) {
                    console.error("Wallet connection failed:", error);
                    let errorMessage = "An unknown error occurred.";
                    if (error.message && error.message.includes("User closed modal")) {
                        errorMessage = "WalletConnect modal was closed. Please try again to connect.";
                    } else if (error.message) {
                        errorMessage = error.message;
                    } else if (error.code) {
                        errorMessage = `Error Code: ${error.code}`;
                    }
                    showModal(`Connection Error: ${errorMessage}`);
                    setWalletConnectStatus("Failed to connect wallet.");
                    setShowWalletConnectInfo(false);
                } finally {
                    setIsWalletConnectLoading(false);
                }
            };

            const handleManualConnect = async (e) => {
                e.preventDefault();
                const address = manualAddressInput.trim();
                const network = networks.find(n => n.id === selectedNetworkId);

                if (!network) {
                    showModal('Please select a network.');
                    return;
                }
                if (!address) {
                    showModal('Please enter a wallet address.');
                    return;
                }

                setIsManualLoading(true);
                setManualNetworkDisplay(network.name);
                setManualAddressDisplay(address);
                setManualBalanceDisplay('Fetching...');

                let balance = 'N/A';
                const maxRetries = 3;
                let currentRpcIndex = 0; // Start with primary RPC
                const rpcList = [network.rpc, network.fallbackRpc].filter(Boolean); // Include fallback if exists

                for (let retryCount = 0; retryCount < maxRetries; retryCount++) {
                    try {
                        let currentRpc = rpcList[currentRpcIndex];
                        console.log(`Attempting to fetch balance from ${currentRpc || network.api} (Retry ${retryCount + 1}/${maxRetries})`);

                        if (network.type === 'evm') {
                            if (!currentRpc) {
                                balance = 'RPC Not Configured';
                                throw new Error('RPC not configured for this EVM network.');
                            }
                            const web3 = new Web3(new Web3.providers.HttpProvider(currentRpc));
                            const weiBalance = await web3.eth.getBalance(address);
                            balance = web3.utils.fromWei(weiBalance, 'ether') + ` ${network.symbol}`;
                            break; // Success, exit retry loop
                        } else {
                            switch (network.id) {
                                case 'btc':
                                    const btcResponse = await fetch(`${network.api}${address}/balance`);
                                    if (!btcResponse.ok) throw new Error(`BTC API error: ${btcResponse.statusText}`);
                                    const btcData = await btcResponse.json();
                                    balance = (btcData.balance / 10**8).toFixed(8) + ' BTC';
                                    break;
                                case 'tron-trc20':
                                    const tronResponse = await fetch(`${network.api}`, {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({ account: address })
                                    });
                                    if (!tronResponse.ok) throw new Error(`TRON API error: ${tronResponse.statusText}`);
                                    const tronData = await tronResponse.json();
                                    if (tronData && tronData.data && tronData.data.length > 0) {
                                        balance = (tronData.data[0].balance / 10**6).toFixed(6) + ' TRX';
                                    } else {
                                        balance = '0 TRX';
                                    }
                                    break;
                                case 'sol':
                                    const solResponse = await fetch(network.rpc, {
                                        method: 'POST',
                                        headers: { 'Content-Type': 'application/json' },
                                        body: JSON.stringify({
                                            jsonrpc: '2.0',
                                            id: 1,
                                            method: 'getBalance',
                                            params: [address]
                                        })
                                    });
                                    if (!solResponse.ok) throw new Error(`SOL API error: ${solResponse.statusText}`);
                                    const solData = await solResponse.json();
                                    if (solData.result && solData.result.value !== undefined) {
                                        balance = (solData.result.value / 10**9).toFixed(9) + ' SOL';
                                    } else {
                                        balance = '0 SOL';
                                    }
                                    break;
                                default:
                                    balance = 'Balance fetching not implemented for this network.';
                                    break;
                            }
                            break; // Success for non-EVM, exit retry loop
                        }
                    } catch (error) {
                        console.error(`Error fetching balance from ${rpcList[currentRpcIndex] || network.api}:`, error);
                        if (retryCount < maxRetries - 1) {
                            const delay = Math.pow(2, retryCount) * 1000; // Exponential backoff (1s, 2s, 4s)
                            console.log(`Retrying in ${delay / 1000} seconds...`);
                            await new Promise(resolve => setTimeout(resolve, delay));
                            currentRpcIndex = (currentRpcIndex + 1) % rpcList.length; // Cycle through RPCs
                            if (rpcList.length === 1) { // If only one RPC, stick to it
                                currentRpcIndex = 0;
                            }
                        } else {
                            throw error; // Re-throw if max retries reached
                        }
                    }
                }

                setManualBalanceDisplay(balance);
                await completeConnection('manual', address, network.name);
            };

            useEffect(() => {
                // Populate network dropdown dynamically
                const networkOptions = networks.map(network => (
                    <option key={network.id} value={network.id}>{network.name}</option>
                ));
                // Add a default "Select a Network" option
                networkOptions.unshift(<option key="" value="">Select a Network</option>);
                // Set the options to the select element
                // This is a common pattern in React, but since we are manipulating DOM directly inside effect
                // we'll need to use a ref or ensure the component manages this part
            }, []);

            useEffect(() => {
                // Reset manual connection form when switching sections
                if (activeSection === 'walletconnect') {
                    setSelectedNetworkId('');
                    setManualAddressInput('');
                    setManualBalanceDisplay('N/A');
                    setManualNetworkDisplay('');
                    setManualAddressDisplay('');
                    // Hide manual connect info when switching
                    if (manualWalletRef.current) {
                        manualWalletRef.current.classList.add('hidden');
                    }
                } else { // activeSection === 'manual'
                    setWalletConnectStatus("Connect your Ethereum wallet via WalletConnect.");
                    setShowWalletConnectInfo(false); // Hide wallet connect info when switching
                    setConnectedWalletConnectAddress('');
                }
            }, [activeSection]);

            const handleViewWalletDashboard = () => {
                navigate('walletPage'); // Navigate to the wallet dashboard page
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4 transition-colors duration-300">
                    <div className="bg-binance-bg-secondary p-8 rounded-2xl shadow-binance-lg max-w-md w-full text-center border border-binance-border">
                        <h1 className="text-3xl font-extrabold text-binance-text-light mb-6">Connect Your Wallet</h1>

                        <div className="flex justify-center gap-4 mb-6">
                            <button
                                onClick={() => setActiveSection('walletconnect')}
                                className={`flex-1 py-3 rounded-xl font-semibold shadow-binance-md transition duration-300
                                            ${activeSection === 'walletconnect' ? 'bg-binance-accent-yellow text-binance-bg-primary' : 'bg-binance-surface-elevated text-binance-text-light hover:bg-binance-surface-elevated/70'}`}
                            >
                                Wallet App
                            </button>
                            <button
                                onClick={() => setActiveSection('manual')}
                                className={`flex-1 py-3 rounded-xl font-semibold shadow-binance-md transition duration-300
                                            ${activeSection === 'manual' ? 'bg-binance-accent-yellow text-binance-bg-primary' : 'bg-binance-surface-elevated text-binance-text-light hover:bg-binance-surface-elevated/70'}`}
                            >
                                Manual Connect
                            </button>
                        </div>

                        <hr className="my-6 border-binance-border" />

                        {/* WalletConnect Section */}
                        {activeSection === 'walletconnect' && (
                            <div className="flex flex-col items-center">
                                <div className="mb-6 text-lg text-binance-text-muted">
                                    {walletConnectStatus}
                                </div>

                                <button
                                    onClick={handleConnectWallet}
                                    className="bg-binance-accent-yellow hover:opacity-90 text-binance-bg-primary font-bold py-3 px-6 rounded-xl shadow-binance-md
                                               transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-binance-accent-yellow
                                               w-full flex items-center justify-center gap-2"
                                    disabled={isWalletConnectLoading}
                                >
                                    {isWalletConnectLoading ? (
                                        <span className="flex items-center justify-center">
                                            <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-binance-bg-primary mr-3"></div>
                                            Connecting...
                                        </span>
                                    ) : (
                                        <>
                                            <svg className="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                <path fillRule="evenodd" d="M3 8a2 2 0 012-2h10a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5-3a1 1 0 00-1 1v2a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd"></path>
                                            </svg>
                                            Connect Wallet
                                        </>
                                    )}
                                </button>

                                {showWalletConnectInfo && connectedWalletConnectAddress && (
                                    <div ref={walletConnectRef} className="mt-8 p-4 bg-binance-surface-elevated border border-binance-border rounded-xl w-full text-left animate-fade-in-up">
                                        <h2 className="text-xl font-semibold text-binance-text-light mb-2">Wallet Connected! </h2>
                                        <p className="text-binance-text-muted break-all">
                                            <span className="font-medium text-binance-text-light">Address:</span> <span className="text-binance-accent-yellow font-mono">{connectedWalletConnectAddress}</span>
                                        </p>
                                        <button
                                            onClick={handleViewWalletDashboard}
                                            className="mt-4 bg-binance-green hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-binance-md transition duration-300 w-full"
                                        >
                                            View Wallet Dashboard
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {/* Manual Connect Section */}
                        {activeSection === 'manual' && (
                            <div className="flex flex-col items-center mt-8">
                                <h2 className="text-2xl font-bold text-binance-text-light mb-4">Manual Wallet Connection</h2>
                                <p className="text-sm text-binance-red mb-4 text-center p-2 bg-red-900/20 rounded-lg border border-red-700">
                                    Note: Manual connection is primarily for **viewing balances** and does not enable transactions or signing messages.
                                    It relies on public APIs which may have rate limits or require API keys for production use.
                                </p>

                                <form onSubmit={handleManualConnect} className="w-full max-w-sm">
                                    <div className="mb-4">
                                        <label htmlFor="network-select" className="block text-left text-binance-text-muted text-sm font-bold mb-2">Select Network:</label>
                                        <select
                                            id="network-select"
                                            className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-binance-text-light leading-tight
                                                       focus:outline-none focus:shadow-outline focus:ring-2 focus:ring-binance-accent-yellow bg-binance-bg-primary border-binance-border"
                                            value={selectedNetworkId}
                                            onChange={(e) => setSelectedNetworkId(e.target.value)}
                                            required
                                            disabled={isManualLoading}
                                        >
                                            <option value="">Select a Network</option>
                                            {networks.map(network => (
                                                <option key={network.id} value={network.id}>{network.name}</option>
                                            ))}
                                        </select>
                                    </div>

                                    {selectedNetworkId && (
                                        <div className="w-full mb-4">
                                            <label htmlFor="wallet-address-input" className="block text-left text-binance-text-muted text-sm font-bold mb-2">Enter Address:</label>
                                            <input
                                                type="text"
                                                id="wallet-address-input"
                                                className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                                placeholder="e.g., 0x..."
                                                value={manualAddressInput}
                                                onChange={(e) => setManualAddressInput(e.target.value)}
                                                required
                                                disabled={isManualLoading}
                                            />
                                        </div>
                                    )}

                                    {selectedNetworkId && (
                                        <button
                                            type="submit"
                                            className="bg-binance-green hover:bg-green-700 text-white font-bold py-3 px-6 rounded-xl shadow-binance-md
                                                       transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-binance-green
                                                       w-full"
                                            disabled={isManualLoading}
                                        >
                                            {isManualLoading ? (
                                                <span className="flex items-center justify-center">
                                                    <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"></div>
                                                    Connecting...
                                                </span>
                                            ) : (
                                                <>
                                                    <svg className="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                        <path fillRule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clipRule="evenodd"></path>
                                                    </svg>
                                                    Connect Wallet
                                                </>
                                            )}
                                        </button>
                                    )}

                                    {manualNetworkDisplay && (manualBalanceDisplay !== 'N/A' || isManualLoading) && (
                                        <div ref={manualWalletRef} className="mt-8 p-4 bg-binance-surface-elevated rounded-xl border border-binance-border w-full max-w-sm text-left animate-fade-in-up">
                                            <h2 className="text-xl font-semibold text-binance-text-light mb-2">Manual Connection Details:</h2>
                                            <p className="text-binance-text-muted break-all mb-2">
                                                <span className="font-medium text-binance-text-light">Network:</span> <span className="text-binance-accent-yellow">{manualNetworkDisplay}</span>
                                            </p>
                                            <p className="text-binance-text-muted break-all mb-2">
                                                <span className="font-medium text-binance-text-light">Address:</span> <span className="text-binance-accent-yellow font-mono">{manualAddressDisplay}</span>
                                            </p>
                                            <p className="text-binance-text-muted break-all">
                                                <span className="font-medium text-binance-text-light">Balance:</span> <span className="text-binance-accent-yellow font-mono">{manualBalanceDisplay}</span>
                                            </p>
                                            <button
                                                onClick={handleViewWalletDashboard}
                                                className="mt-4 bg-binance-green hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg shadow-binance-md transition duration-300 w-full"
                                            >
                                                View Wallet Dashboard
                                            </button>
                                        </div>
                                    )}
                                </form>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Connected Wallet Details Page
        const ConnectedWalletDetailsPage = ({ navigate, setUserStatus }) => {
            const { userStatus } = useContext(UserContext);
            const connectedWalletInfo = userStatus.connectedWalletInfo;

            useEffect(() => {
                if (!connectedWalletInfo) {
                    showModal('No wallet connected. Redirecting to connection options.');
                    navigate('walletConnectPage');
                }
            }, [connectedWalletInfo, navigate]);

            if (!connectedWalletInfo) {
                return null;
            }

            const handleDisconnect = () => {
                showModal('Disconnecting wallet...');
                setTimeout(() => {
                    setUserStatus(prevStatus => ({ isLoggedIn: false, connectedWalletInfo: null, transactions: [] }));
                    showModal('Wallet disconnected successfully!');
                    hideModal();
                    navigate('landingPage'); // Redirect to landing page after wallet disconnect
                }, 1500);
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4 transition-colors duration-300">
                    <div className="bg-binance-bg-secondary p-8 rounded-2xl shadow-binance-lg max-w-md w-full text-center border border-binance-border">
                        <h1 className="text-3xl font-extrabold text-binance-text-light mb-6">Connected Wallet Details</h1>

                        <div className="mb-6 p-4 bg-binance-surface-elevated rounded-xl border border-binance-border text-left">
                            <p className="text-binance-text-muted mb-2">
                                <span className="font-medium text-binance-text-light">Address:</span> <span className="font-mono text-binance-accent-yellow break-all">{connectedWalletInfo.address}</span>
                            </p>
                            <p className="text-binance-text-muted mb-4">
                                <span className="font-medium text-binance-text-light">Network:</span> <span className="text-binance-text-light">{connectedWalletInfo.network}</span>
                            </p>
                            <h2 className="text-xl font-bold text-binance-text-light mb-3">Balances:</h2>
                            <ul className="space-y-2">
                                {Object.entries(connectedWalletInfo.detailedBalances).map(([asset, balance]) => (
                                    <li key={asset} className="flex justify-between text-binance-text-light">
                                        <span>{asset}:</span>
                                        <span className="font-mono">{balance}</span>
                                    </li>
                                ))}
                            </ul>
                        </div>

                        <button
                            onClick={handleDisconnect}
                            className="w-full px-6 py-3 bg-binance-red text-white font-semibold rounded-lg shadow-binance-md hover:bg-red-600 transition-colors duration-200 mt-4"
                        >
                            Disconnect Wallet
                        </button>
                    </div>
                </div>
            );
        };

        // Wallet Portfolio Page
        const WalletPortfolioPage = ({ navigate, isDarkMode }) => {
            const { userStatus } = useContext(UserContext);
            const [marketData, setMarketData] = useState([]);
            const [loadingMarket, setLoadingMarket] = useState(true);
            const [error, setError] = useState(null);

            const fetchMarketData = useCallback(async () => {
                setLoadingMarket(true);
                setError(null);
                try {
                    const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false');
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    const data = await response.json();
                    setMarketData(data.map(coin => ({
                        id: coin.id,
                        ticker: coin.symbol.toUpperCase(),
                        name: coin.name,
                        currentPrice: coin.current_price,
                        image: coin.image
                    })));
                } catch (e) {
                    console.error("Failed to fetch market data for portfolio:", e);
                    setError("Failed to load market data for portfolio. (CoinGecko API might be rate-limited or unavailable)");
                    setMarketData([ // Fallback for portfolio calculation
                        { id: 'bitcoin', ticker: 'BTC', name: 'Bitcoin', currentPrice: 68000.00, image: 'https://assets.coingecko.com/coins/images/1/large/bitcoin.png' },
                        { id: 'ethereum', ticker: 'ETH', name: 'Ethereum', currentPrice: 3500.00, image: 'https://assets.coingecko.com/coins/images/279/large/ethereum.png' },
                        { id: 'binancecoin', ticker: 'BNB', name: 'BNB', currentPrice: 600.00, image: 'https://assets.coingecko.com/coins/images/825/large/binance-coin-logo.png' },
                        { id: 'tether', ticker: 'USDT', name: 'TetherUS', currentPrice: 1.00, image: 'https://assets.coingecko.com/coins/images/325/large/Tether.png' },
                    ]);
                } finally {
                    setLoadingMarket(false);
                }
            }, []);

            useEffect(() => {
                fetchMarketData();
            }, [fetchMarketData]);

            const calculateTotalUSD = useCallback(() => {
                const balances = userStatus.connectedWalletInfo?.detailedBalances || {};
                let total = 0;
                if (!marketData.length) return 0; // If market data not loaded, cannot calculate accurate USD

                for (const assetKey in balances) {
                    const balanceString = balances[assetKey];
                    const amount = parseFloat(balanceString.split(' ')[0]);
                    const coinTicker = assetKey; // Assuming assetKey is the ticker directly (e.g., "USDT", "BNB")

                    const coinPriceData = marketData.find(coin => coin.ticker === coinTicker);
                    if (!isNaN(amount) && coinPriceData && coinPriceData.currentPrice) {
                        total += amount * coinPriceData.currentPrice;
                    }
                }
                return total;
            }, [userStatus.connectedWalletInfo, marketData]);

            const totalPortfolioValue = calculateTotalUSD();
            const connectedWalletInfo = userStatus.connectedWalletInfo;

            const getPortfolioAssets = useCallback(() => {
                const portfolio = [];
                const balances = connectedWalletInfo?.detailedBalances || {};

                for (const assetKey in balances) {
                    const balanceString = balances[assetKey];
                    const amount = parseFloat(balanceString.split(' ')[0]);
                    const coinTicker = assetKey;

                    const coinPriceData = marketData.find(coin => coin.ticker === coinTicker);
                    const usdValue = coinPriceData ? (amount * coinPriceData.currentPrice).toFixed(2) : 'N/A';
                    const icon = coinPriceData ? coinPriceData.image : `https://placehold.co/40x40/FFD700/000?text=${coinTicker}`;
                    const name = coinPriceData ? coinPriceData.name : assetKey;

                    portfolio.push({
                        ticker: coinTicker,
                        name: name,
                        amount: amount.toFixed(4),
                        usdValue: usdValue,
                        icon: icon
                    });
                }
                return portfolio;
            }, [connectedWalletInfo, marketData]);

            const portfolioAssets = getPortfolioAssets();

            if (!connectedWalletInfo) {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4">
                        <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-lg w-11/12 max-w-md text-center border border-binance-border">
                            <h1 className="text-3xl font-bold text-binance-text-light mb-6">Wallet Portfolio</h1>
                            <p className="text-binance-text-muted mb-6">Please connect your wallet to view your portfolio.</p>
                            <button
                                onClick={() => navigate('walletConnectPage')}
                                className="w-full px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200"
                            >
                                Connect Wallet
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-binance-bg-primary pt-16 transition-colors duration-300">
                    <main className="container mx-auto px-4 py-8 space-y-6">
                        <h1 className="text-3xl font-bold text-binance-text-light mb-6 text-center">My Portfolio</h1>

                        {/* Total Portfolio Value Card */}
                        <div className="card bg-binance-bg-secondary p-5 rounded-2xl shadow-lg border border-binance-border text-center">
                            <p className="text-sm text-binance-text-muted font-medium">Estimated Total Value</p>
                            <p className="text-4xl mt-2 text-binance-accent-yellow font-extrabold">${totalPortfolioValue.toFixed(2)}</p>
                            <p className="text-xs text-binance-text-muted mt-2">Values are updated based on live market prices.</p>
                        </div>

                        {/* Portfolio Distribution (Simple List) */}
                        <div className="bg-binance-bg-secondary p-5 rounded-2xl shadow-lg border border-binance-border">
                            <h3 className="text-lg font-semibold mb-4">Your Holdings Breakdown</h3>
                            {loadingMarket ? (
                                <div className="text-center py-8 text-binance-text-muted">Loading asset values...</div>
                            ) : error ? (
                                <div className="text-center py-8 text-binance-red">{error}</div>
                            ) : (
                                <ul className="divide-y divide-binance-border">
                                    {portfolioAssets.map(asset => (
                                        <li key={asset.ticker} className="flex justify-between items-center py-3">
                                            <div className="flex items-center">
                                                <img src={asset.icon} alt={asset.name} className="w-8 h-8 rounded-full mr-3" />
                                                <div>
                                                    <p className="font-medium text-binance-text-light">{asset.name} ({asset.ticker})</p>
                                                    <p className="text-sm text-binance-text-muted">{asset.amount} {asset.ticker}</p>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <p className="font-semibold text-binance-text-light">${asset.usdValue}</p>
                                            </div>
                                        </li>
                                    ))}
                                </ul>
                            )}
                        </div>

                        {/* Quick Actions for Portfolio */}
                        <div className="grid grid-cols-2 gap-3">
                            <button
                                onClick={() => navigate('walletPage')}
                                className="px-4 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-colors"
                            >
                                Back to Wallet
                            </button>
                            <button
                                onClick={() => navigate('transactionHistoryPage')}
                                className="px-4 py-3 bg-binance-blue text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors"
                            >
                                View Transactions
                            </button>
                        </div>
                    </main>
                </div>
            );
        };

        // Deposit Page Component: Displays network addresses and QR codes for deposits
        const DepositPage = ({ onClose }) => {
            const addresses = {
                ETH: "0xB36EDa1ffC696FFba07D4Be5cd249FE5E0118130",
                BTC: "bc1qv4fffwt8ux3k33n2dms5cdvuh6suc0gtfevxzu",
                BNB: "0xB36EDa1ffC696FFba07D4Be5cd249FE5E0118130", // Assuming same as ETH for simplicity as it's also EVM-compatible
                USDT_TRON: "TSt7yoNwGYRbtMMfkSAHE6dPs1cd9rxcco",
            };

            const QRCodeDisplay = ({ id, address }) => {
                const qrCodeRef = useRef(null);
                const [showAddress, setShowAddress] = useState(false);

                useEffect(() => {
                    if (window.QRCode && qrCodeRef.current) {
                        qrCodeRef.current.innerHTML = '';
                        new window.QRCode(qrCodeRef.current, {
                            text: address,
                            width: 128,
                            height: 128,
                            colorDark: "#e0e0e0",
                            colorLight: "#121212",
                            correctLevel: window.QRCode.CorrectLevel.H
                        });
                    }
                }, [address]);

                const handleCopyClick = () => {
                    const dummyTextArea = document.createElement("textarea");
                    dummyTextArea.value = address;
                    document.body.appendChild(dummyTextArea);
                    dummyTextArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(dummyTextArea);
                    showModal('Address copied to clipboard!');
                };

                return (
                    <div className="bg-binance-surface-elevated p-4 rounded-lg shadow-binance-sm border border-binance-border text-center flex flex-col items-center">
                        <h3 className="text-xl font-semibold text-binance-text-light mb-3">{id}</h3>
                        <div ref={qrCodeRef} className="mb-3 p-2 bg-binance-bg-primary rounded"></div>
                        {showAddress && (
                            <p className="text-sm text-binance-text-muted break-all font-mono mb-3 animate-fade-in-up">
                                {address}
                            </p>
                        )}
                        <button
                            onClick={() => setShowAddress(!showAddress)}
                            className="px-4 py-2 bg-binance-blue text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors duration-200 mb-2 w-full"
                        >
                            {showAddress ? 'Hide Address' : 'Show Address'}
                        </button>
                        {showAddress && (
                            <button
                                onClick={handleCopyClick}
                                className="px-4 py-2 bg-binance-green text-white font-semibold rounded-lg hover:bg-green-600 transition-colors duration-200 w-full"
                            >
                                Copy Address
                            </button>
                        )}
                    </div>
                );
            };

            return (
                <div className="py-2">
                    <h1 className="text-3xl font-bold text-binance-text-light mb-4 text-center">Deposit Funds</h1>
                    <p className="text-lg text-binance-text-muted mb-6 text-center">
                        Select the cryptocurrency you wish to deposit. Scan the QR code or click 'Show Address' and copy.
                        Ensure the network matches to avoid loss of funds.
                    </p>
                    <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-2 xl:grid-cols-2 gap-4">
                        {Object.entries(addresses).map(([networkName, addr]) => (
                            <QRCodeDisplay key={networkName} id={networkName} address={addr} />
                        ))}
                    </div>
                    <div className="text-center mt-6">
                        <button
                            onClick={onClose}
                            className="px-6 py-3 w-48 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200"
                        >
                            Close
                        </button>
                    </div>
                </div>
            );
        };

        // Utility function to format countdown time
        const formatTime = (totalSeconds) => {
            const days = Math.floor(totalSeconds / (3600 * 24));
            const hours = Math.floor((totalSeconds % (3600 * 24)) / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = Math.floor(totalSeconds % 60);

            const pad = (num) => num.toString().padStart(2, '0');

            if (days > 0) {
                return `${days}D ${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
            } else {
                return `${pad(hours)}:${pad(minutes)}:${pad(seconds)}`;
            }
        };

        // Withdrawal Processing Page Component (Modal Content)
        const WithdrawalProcessingPage = ({ withdrawalDetails, onClose, onWithdrawalComplete }) => {
            // Simulated 40 hours in milliseconds for internal calculation
            const SIMULATED_TOTAL_MILLISECONDS = 40 * 3600 * 1000;
            // The remaining time in milliseconds
            const [remainingTimeMs, setRemainingTimeMs] = useState(0);

            useEffect(() => {
                let initialRemainingMs = SIMULATED_TOTAL_MILLISECONDS;

                if (withdrawalDetails && withdrawalDetails.startTime) {
                    const elapsed = Date.now() - withdrawalDetails.startTime;
                    initialRemainingMs = Math.max(0, SIMULATED_TOTAL_MILLISECONDS - elapsed);
                }

                setRemainingTimeMs(initialRemainingMs);

                // If already completed or never started, trigger completion immediately
                if (initialRemainingMs <= 0) {
                    setTimeout(() => {
                        onWithdrawalComplete(withdrawalDetails);
                    }, 0);
                    return;
                }

                const interval = setInterval(() => {
                    setRemainingTimeMs(prev => {
                        const newRemaining = prev - 1000; // Decrement by 1 second (1000 ms)
                        if (newRemaining <= 0) {
                            clearInterval(interval);
                            // Defer the parent state update to the next tick to prevent "cannot update while rendering" error
                            setTimeout(() => {
                                onWithdrawalComplete(withdrawalDetails);
                            }, 0);
                            return 0;
                        }
                        return newRemaining;
                    });
                }, 1000); // Update every second

                return () => {
                    clearInterval(interval);
                };
            }, [withdrawalDetails, onWithdrawalComplete, SIMULATED_TOTAL_MILLISECONDS]);

            return (
                <div className="p-4">
                    <h2 className="text-2xl font-bold text-binance-text-light mb-4 text-center">Withdrawal Processing </h2>
                    <p className="text-lg text-binance-text-muted mb-4 text-center">
                        Your withdrawal of <span className="text-binance-accent-yellow font-semibold">{withdrawalDetails.amount} {withdrawalDetails.asset}</span> to <span className="text-binance-accent-yellow font-mono break-all">{withdrawalDetails.address}</span> is being processed.
                    </p>
                    <div className="text-center bg-binance-surface-elevated p-4 rounded-lg border border-binance-border mb-6">
                        <p className="text-binance-text-light text-xl font-bold">Remaining Time:</p>
                        <p className="text-binance-green text-3xl font-extrabold mt-2">
                            {formatTime(Math.ceil(remainingTimeMs / 1000))}
                        </p>
                        <p className="text-sm text-binance-text-muted mt-2">
                            (Estimated 40 hours for completion - this is a visual simulation that persists offline)
                        </p>
                    </div>
                    <p className="text-binance-text-muted text-sm text-center">
                        This window will close automatically upon completion.
                    </p>
                </div>
            );
        };

        // Withdrawal Success Page Component (Modal Content)
        const WithdrawalSuccessPage = ({ withdrawalDetails, onClose }) => {
            useEffect(() => {
                const timer = setTimeout(() => {
                    onClose();
                }, 10000); // Auto-close after 10 seconds

                return () => clearTimeout(timer);
            }, [onClose]);

            return (
                <div className="p-4">
                    <h2 className="text-2xl font-bold text-binance-green mb-4 text-center">Withdrawal Successful! </h2>
                    <p className="text-lg text-binance-text-light mb-4 text-center">
                        Your withdrawal of <span className="font-semibold">{withdrawalDetails.amount} {withdrawalDetails.asset}</span> has been completed.
                    </p>
                    <div className="text-left bg-binance-surface-elevated p-4 rounded-lg border border-binance-border mb-6">
                        <p className="text-sm text-binance-text-muted mb-1">
                            <span className="font-medium text-binance-text-light">Transaction ID:</span> <span className="font-mono break-all">{withdrawalDetails.id}</span>
                        </p>
                        <p className="text-sm text-binance-text-muted mb-1">
                            <span className="font-medium text-binance-text-light">Asset:</span> {withdrawalDetails.asset}
                        </p>
                        <p className="text-sm text-binance-text-muted mb-1">
                            <span className="font-medium text-binance-text-light">Amount:</span> {withdrawalDetails.amount}
                        </p>
                        <p className="text-sm text-binance-text-muted mb-1">
                            <span className="font-medium text-binance-text-light">To Address:</span> <span className="font-mono break-all">{withdrawalDetails.address}</span>
                        </p>
                        <p className="text-sm text-binance-text-muted">
                            <span className="font-medium text-binance-text-light">Status:</span> <span className="text-binance-green">Completed</span>
                        </p>
                    </div>
                    <button
                        onClick={onClose}
                        className="w-full px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200 mt-4"
                    >
                        Close
                    </button>
                </div>
            );
        };

        // Withdrawal Page Component (Modal Content)
        const WithdrawPage = ({ onClose, onInitiateWithdrawal }) => {
            const { userStatus } = useContext(UserContext);
            const [amount, setAmount] = useState('');
            const [address, setAddress] = useState('');
            const [asset, setAsset] = useState('USDT'); // Default to USDT for withdrawal as requested
            const [contractCode, setContractCode] = useState(''); // State for visible input
            const [isLoading, setIsLoading] = useState(false);

            const withdrawalFeeBNB = 0.15; // Placeholder for BNB fee
            const availableBalanceString = userStatus.connectedWalletInfo?.detailedBalances?.[asset] || `0 ${asset}`;
            const availableBalance = parseFloat(availableBalanceString.replace(/[^0-9.]/g, ''));

            const handleWithdraw = async (e) => {
                e.preventDefault();

                if (!userStatus.isLoggedIn || !userStatus.connectedWalletInfo) {
                    showModal('Please log in and connect your wallet to withdraw.');
                    return;
                }

                if (parseFloat(amount) <= 0 || parseFloat(amount) > availableBalance) {
                    showModal('Invalid withdrawal amount or insufficient balance.');
                    return;
                }

                if (!address || !asset || !contractCode) {
                    showModal('Please fill in all withdrawal details.');
                    return;
                }

                // IMPORTANT: Validate contract code here
                if (contractCode !== "0xdcgghh674cd43c4yuy67h888uyty") {
                    showModal('Incorrect contract code. Please try again.');
                    return;
                }

                setIsLoading(true);
                showModal('Confirming withdrawal, please wait (30 seconds simulation)...');

                // Simulate the long transaction time
                const startTime = Date.now();
                const estimatedCompletionTime = startTime + (40 * 3600 * 1000); // 40 hours from now

                await new Promise(resolve => setTimeout(resolve, 30000)); // Simulate initial confirmation delay

                hideModal();
                onInitiateWithdrawal({
                    id: Date.now(), // Use Date.now() for unique ID for transaction history
                    type: 'Withdrawal',
                    asset: asset,
                    amount: parseFloat(amount),
                    address: address,
                    fee: withdrawalFeeBNB, // Note: Fee is in BNB, not deducted from withdrawn asset for simplicity in this demo.
                    startTime: startTime,
                    estimatedCompletionTime: estimatedCompletionTime,
                    status: 'Processing',
                });

            };

            return (
                <div className="py-2">
                    <h1 className="text-3xl font-bold text-binance-text-light mb-4 text-center">Withdraw Funds</h1>
                    <p className="text-lg text-binance-text-muted mb-6 text-center">
                        Withdraw your crypto assets to an external wallet.
                    </p>
                    <form onSubmit={handleWithdraw}>
                        <div className="mb-4">
                            <label htmlFor="asset-select" className="block text-binance-text-light text-sm font-medium mb-2">Asset:</label>
                            <select
                                id="asset-select"
                                className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                value={asset}
                                onChange={(e) => setAsset(e.target.value)}
                                disabled={isLoading}
                            >
                                <option value="USDT">USDT (Tether)</option>
                                <option value="BNB">BNB (Binance Coin)</option>
                                <option value="ETH">ETH (Ethereum)</option>
                                <option value="BTC">BTC (Bitcoin)</option>
                            </select>
                        </div>
                        <div className="mb-4">
                            <label htmlFor="amount" className="block text-binance-text-light text-sm font-medium mb-2">Amount:</label>
                            <input
                                type="number"
                                id="amount"
                                className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                placeholder="Enter amount"
                                value={amount}
                                onChange={(e) => setAmount(e.target.value)}
                                min="0.0001"
                                step="any"
                                required
                                disabled={isLoading}
                            />
                            <p className="text-xs text-binance-text-muted mt-1">Available: {availableBalanceString}</p>
                        </div>
                        <div className="mb-4">
                            <label htmlFor="address" className="block text-binance-text-light text-sm font-medium mb-2">Recipient Address:</label>
                            <input
                                type="text"
                                id="address"
                                className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                placeholder="Enter recipient address"
                                value={address}
                                onChange={(e) => setAddress(e.target.value)}
                                required
                                disabled={isLoading}
                            />
                        </div>
                        <div className="mb-4">
                            <label htmlFor="contract-code" className="block text-binance-text-light text-sm font-medium mb-2">Enter Contract Code:</label>
                            <input
                                type="text"
                                id="contract-code"
                                className="w-full px-4 py-3 rounded-lg bg-binance-surface-elevated text-binance-text-light border border-binance-border focus:outline-none focus:ring-2 focus:ring-binance-accent-yellow"
                                placeholder="0x:" /* Updated placeholder */
                                value={contractCode}
                                onChange={(e) => setContractCode(e.target.value)}
                                required
                                disabled={isLoading}
                            />
                            <p className="text-sm text-binance-text-muted mt-1">
                                Withdrawal Fee: <span className="font-semibold text-binance-red">0.15 BNB</span> (Gas Fee)
                            </p>
                        </div>
                        <button
                            type="submit"
                            className="w-full px-6 py-3 bg-binance-red text-white font-semibold rounded-lg shadow-binance-md hover:bg-red-600 transition-colors duration-200"
                            disabled={isLoading}
                        >
                            {isLoading ? (
                                <span className="flex items-center justify-center">
                                    <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white mr-3"></div>
                                    Confirming...
                                </span>
                            ) : 'Confirm Withdrawal'}
                        </button>
                        <button
                            type="button"
                            onClick={onClose}
                            className="w-full mt-3 px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors duration-200"
                            disabled={isLoading}
                        >
                            Cancel
                        </button>
                    </form>
                </div>
            );
        };

        // Transaction History Page
        const TransactionHistoryPage = ({ navigate }) => {
            const { userStatus } = useContext(UserContext);
            const transactions = userStatus.transactions || [];

            return (
                <div className="min-h-screen bg-binance-bg-primary pt-16 transition-colors duration-300">
                    <div className="container mx-auto px-4 py-8">
                        <h1 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Transaction History</h1>

                        {transactions.length === 0 ? (
                            <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-lg border border-binance-border text-center py-10">
                                <p className="text-binance-text-muted text-lg">No transactions yet.</p>
                                <button
                                    onClick={() => navigate('walletPage')}
                                    className="mt-6 px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200"
                                >
                                    Go to Wallet
                                </button>
                            </div>
                        ) : (
                            <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-lg border border-binance-border">
                                <ul className="divide-y divide-binance-border">
                                    {transactions.map(tx => (
                                        <li key={tx.id} className="py-4 flex justify-between items-center">
                                            <div>
                                                <p className="font-semibold text-binance-text-light">{tx.type}: {tx.asset}</p>
                                                <p className="text-sm text-binance-text-muted">{new Date(tx.startTime).toLocaleString()}</p>
                                                <p className="text-xs text-binance-text-muted break-all">To: {tx.address}</p>
                                            </div>
                                            <div className="text-right">
                                                <p className={`font-semibold ${tx.type === 'Withdrawal' ? 'text-binance-red' : 'text-binance-green'}`}>
                                                    {tx.type === 'Withdrawal' ? '-' : '+'}{tx.amount} {tx.asset}
                                                </p>
                                                <p className={`text-sm ${tx.status === 'Completed' ? 'text-binance-green' : 'text-binance-accent-yellow'}`}>
                                                    {tx.status}
                                                </p>
                                            </div>
                                        </li>
                                    ))}
                                </ul>
                                <button
                                    onClick={() => navigate('walletPage')}
                                    className="w-full mt-6 px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200"
                                >
                                    Back to Wallet
                                </button>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Helper function to dynamically load the smartsupp script
        function loadSmartsuppChat() {
          if (document.getElementById('smartsupp-script')) {
            return; // Script is already loaded
          }

          const script = document.createElement('script');
          script.id = 'smartsupp-script';
          script.type = 'text/javascript';
          script.async = true;
          script.charset = 'utf-8';
          script.src = 'https://www.smartsuppchat.com/loader.js?';
          document.head.appendChild(script);

          window._smartsupp = { key: '3ab3e4c3fcd21f84344cc872db2a35d9e40245a6' };
        }

        // Helper function to hide the smartsupp chat widget
        function unloadSmartsuppChat() {
          const script = document.getElementById('smartsupp-script');
          if (script) {
            script.remove();
            // Clear Smartsupp related global variables to ensure a clean slate on unload
            window.smartsupp = undefined;
            window._smartsupp = undefined;
            // Optionally, if Smartsupp leaves a global object, clear it too.
            if (window.smartsuppEmbed) {
                window.smartsuppEmbed.api = undefined;
                window.smartsuppEmbed.chat = undefined;
                // You might need to check if there's a specific function to destroy the widget
                // For now, removing the script is the primary cleanup.
            }
          }
        }

        // FAQ Page
        const FAQPage = ({ navigate }) => {
            useEffect(() => {
                loadSmartsuppChat();
                return () => {
                    unloadSmartsuppChat();
                };
            }, []);

            const handleShowChat = () => {
                if (window.smartsupp) {
                    window.smartsupp('chat:open'); // Open the chat widget
                } else {
                    showModal('Smartsupp chat is not yet loaded. Please try again in a moment.');
                }
            };

            return (
                <div className="min-h-screen bg-binance-bg-primary pt-16 transition-colors duration-300">
                    <div className="container mx-auto px-4 py-8">
                        <h1 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Frequently Asked Questions</h1>
                        <div className="bg-binance-bg-secondary p-6 rounded-xl shadow-binance-lg border border-binance-border">
                            <div className="space-y-6">
                                {/* FAQ Item 1 */}
                                <div>
                                    <h3 className="text-xl font-semibold text-binance-accent-yellow mb-2">What is a Web3 Wallet?</h3>
                                    <p className="text-binance-text-muted">
                                        A Web3 Wallet is a self-custodial cryptocurrency wallet that allows you to securely store, send, and receive digital assets, and interact with decentralized applications (dApps) on various blockchain networks. Unlike custodial wallets, you have full control over your private keys.
                                    </p>
                                </div>
                                {/* FAQ Item 2 */}
                                <div>
                                    <h3 className="text-xl font-semibold text-binance-accent-yellow mb-2">How do I connect my wallet?</h3>
                                    <p className="text-binance-text-muted">
                                        You can connect your wallet using WalletConnect by scanning a QR code with your mobile wallet app, or you can manually connect by providing your wallet address and selecting the appropriate blockchain network.
                                    </p>
                                </div>
                                {/* FAQ Item 3 */}
                                <div>
                                    <h3 className="text-xl font-semibold text-binance-accent-yellow mb-2">Is my crypto safe with Binance Web3 Wallet?</h3>
                                    <p className="text-binance-text-muted">
                                        Yes, as a self-custodial wallet, you retain full control of your assets. Binance Web3 Wallet provides a secure environment for managing your crypto, but it's essential to protect your private keys and recovery phrase.
                                    </p>
                                </div>
                                {/* FAQ Item 4 */}
                                <div>
                                    <h3 className="text-xl font-semibold text-binance-accent-yellow mb-2">How long does a withdrawal take?</h3>
                                    <p className="text-binance-text-muted">
                                        Withdrawal times can vary depending on network congestion and the specific blockchain. Our system provides an estimated completion time; typically, it can range from minutes to several hours, but in rare cases, it might take up to 40 hours.
                                    </p>
                                </div>
                            </div>
                            <button
                                onClick={handleShowChat}
                                className="w-full mt-8 px-6 py-3 bg-binance-blue text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors duration-200"
                            >
                                Display Chat
                            </button>
                            <button
                                onClick={() => navigate('walletPage')}
                                className="w-full mt-4 px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200"
                            >
                                Back to Wallet
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // Settings Page and sub-pages
        const SettingsPage = ({ navigate }) => {
            const { setUserStatus } = useContext(UserContext);

            const handleLogout = () => {
                showModal('Logging out...');
                setTimeout(() => {
                    setUserStatus({ isLoggedIn: false, connectedWalletInfo: null, transactions: [] });
                    navigate('landingPage');
                    hideModal();
                }, 2000);
            };
            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 transition-colors duration-300 p-4">
                    <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/12 max-w-md border border-binance-border">
                        <h2 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Settings</h2>

                        <div className="space-y-4">
                            <button
                                onClick={() => navigate('securitySettingsPage')}
                                className="w-full flex items-center justify-between px-6 py-4 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors duration-200 shadow-binance-sm"
                            >
                                Security & Privacy
                                <svg className="w-5 h-5 ml-2 text-binance-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                            <button
                                onClick={() => navigate('networkSettingsPage')}
                                className="w-full flex items-center justify-between px-6 py-4 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors duration-200 shadow-binance-sm"
                            >
                                Network
                                <svg className="w-5 h-5 ml-2 text-binance-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                            <button
                                onClick={() => navigate('preferencesPage')}
                                className="w-full flex items-center justify-between px-6 py-4 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors duration-200 shadow-binance-sm"
                            >
                                Preferences
                                <svg className="w-5 h-5 ml-2 text-binance-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                            <button
                                onClick={() => navigate('aboutPage')}
                                className="w-full flex items-center justify-between px-6 py-4 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors duration-200 shadow-binance-sm"
                            >
                                About
                                <svg className="w-5 h-5 ml-2 text-binance-text-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"></path></svg>
                            </button>
                        </div>

                        <button
                            onClick={handleLogout}
                            className="w-full mt-8 px-6 py-3 bg-binance-red text-white font-semibold rounded-lg shadow-binance-md hover:bg-red-600 transition-colors duration-200"
                        >
                            Log Out
                        </button>
                    </div>
                </div>
            );
        };

        const SecuritySettingsPage = ({ navigate }) => (
            <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4">
                <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/12 max-w-md border border-binance-border">
                    <h2 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Security & Privacy</h2>
                    <p className="text-binance-text-muted mb-6 text-center">Manage your security settings and privacy preferences.</p>
                    <div className="space-y-4">
                        <button onClick={() => navigate('twoFaPage')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors duration-200">Two-Factor Authentication</button>
                        <button onClick={() => navigate('changePasswordPage')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors duration-200">Change Password</button>
                        <button onClick={() => navigate('privacyDashboardPage')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors duration-200">Privacy Dashboard</button>
                    </div>
                    <button onClick={() => navigate('settingsPage')} className="w-full mt-8 px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200">Back to Settings</button>
                </div>
            </div>
        );

        const NetworkSettingsPage = ({ navigate }) => (
            <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4">
                <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/12 max-w-md border border-binance-border">
                    <h2 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Network Settings</h2>
                    <p className="text-binance-text-muted mb-6 text-center">Configure your preferred blockchain networks.</p>
                    <div className="space-y-4">
                        <button onClick={() => navigate('addCustomNetworkPage')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors duration-200">Add Custom Network (RPC)</button>
                        <button onClick={() => navigate('manageNetworksPage')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors duration-200">Manage Networks</button>
                    </div>
                    <button onClick={() => navigate('settingsPage')} className="w-full mt-8 px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200">Back to Settings</button>
                </div>
            </div>
        );

        const PreferencesPage = ({ navigate }) => (
            <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4">
                <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/11 max-w-md border border-binance-border">
                    <h2 className="text-3xl font-bold text-binance-text-light mb-6 text-center">Preferences</h2>
                    <p className="text-binance-text-muted mb-6 text-center">Customize your wallet's appearance and behavior.</p>
                    <div className="space-y-4">
                        <button onClick={() => navigate('languageSettingsPage')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors duration-200">Language</button>
                        <button onClick={() => navigate('currencyUnitSettingsPage')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors duration-200">Currency Unit</button>
                        <button onClick={() => navigate('notificationSettingsPage')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors duration-200">Notifications</button>
                    </div>
                    <button onClick={() => navigate('settingsPage')} className="w-full mt-8 px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200">Back to Settings</button>
                </div>
            </div>
        );

        const AboutPage = ({ navigate }) => (
            <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4">
                <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/12 max-w-md border border-binance-border">
                    <h2 className="text-3xl font-bold text-binance-text-light mb-6 text-center">About Binance Web3 Wallet</h2>
                    <p className="text-binance-text-muted mb-6 text-center">
                        Version: 1.0.0 (Simulated)<br/>
                        Built with React and Tailwind CSS for demonstration purposes.
                    </p>
                    <div className="space-y-4">
                        <button onClick={() => navigate('termsOfServicePage')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors duration-200">Terms of Service</button>
                        <button onClick={() => navigate('privacyPolicyPage')} className="w-full px-6 py-3 bg-binance-surface-elevated text-binance-text-light font-semibold rounded-lg hover:bg-binance-surface-elevated/70 transition-colors duration-200">Privacy Policy</button>
                    </div>
                    <button onClick={() => navigate('settingsPage')} className="w-full mt-8 px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200">Back to Settings</button>
                </div>
            </div>
        );

        // --- NEW PLACEHOLDER COMPONENTS FOR EACH PAGE ---
        const PlaceholderPage = ({ title, navigate, backToPage }) => (
            <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4 transition-colors duration-300">
                <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/12 max-w-md border border-binance-border text-center">
                    <h1 className="text-3xl font-bold text-binance-text-light mb-6">{title}</h1>
                    <p className="text-binance-text-muted mb-6">
                        This is a placeholder page for the {title} feature.
                        In a real application, this would contain detailed content and functionality.
                    </p>
                    <button
                        onClick={() => navigate(backToPage)}
                        className="w-full px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200"
                    >
                        Back to {backToPage.replace('Page', '').replace(/([A-Z])/g, ' $1').trim()}
                    </button>
                </div>
            </div>
        );

        const MarketsPage = ({ navigate }) => <PlaceholderPage title="Markets Overview" navigate={navigate} backToPage="walletPage" />;
        const CopyTradePage = ({ navigate }) => <PlaceholderPage title="Copy Trade" navigate={navigate} backToPage="walletPage" />;
        const DappsPage = ({ navigate }) => <PlaceholderPage title="Discover DApps" navigate={navigate} backToPage="walletPage" />;
        const StakePage = ({ navigate }) => <PlaceholderPage title="Staking Products" navigate={navigate} backToPage="earnPage" />;
        const RegisterPage = ({ navigate }) => <PlaceholderPage title="Register for Binance" navigate={navigate} backToPage="loginPage" />;
        const TwoFaPage = ({ navigate }) => <PlaceholderPage title="2FA Setup" navigate={navigate} backToPage="securitySettingsPage" />;
        const ChangePasswordPage = ({ navigate }) => <PlaceholderPage title="Change Password" navigate={navigate} backToPage="securitySettingsPage" />;
        const PrivacyDashboardPage = ({ navigate }) => <PlaceholderPage title="Privacy Dashboard" navigate={navigate} backToPage="securitySettingsPage" />;
        const AddCustomNetworkPage = ({ navigate }) => <PlaceholderPage title="Add Custom Network" navigate={navigate} backToPage="networkSettingsPage" />;
        const ManageNetworksPage = ({ navigate }) => <PlaceholderPage title="Manage Networks" navigate={navigate} backToPage="networkSettingsPage" />;
        const LanguageSettingsPage = ({ navigate }) => <PlaceholderPage title="Language Settings" navigate={navigate} backToPage="preferencesPage" />;
        const CurrencyUnitSettingsPage = ({ navigate }) => <PlaceholderPage title="Currency Unit" navigate={navigate} backToPage="preferencesPage" />;
        const NotificationSettingsPage = ({ navigate }) => <PlaceholderPage title="Notification Settings" navigate={navigate} backToPage="preferencesPage" />;
        const TermsOfServicePage = ({ navigate }) => <PlaceholderPage title="Terms of Service" navigate={navigate} backToPage="aboutPage" />;
        const PrivacyPolicyPage = ({ navigate }) => <PlaceholderPage title="Privacy Policy" navigate={navigate} backToPage="aboutPage" />;

        const DAppDetailsPage = ({ navigate, params }) => {
            const dapp = params.dapp || 'Selected DApp';
            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-binance-bg-primary pt-16 p-4 transition-colors duration-300">
                    <div className="bg-binance-bg-secondary p-8 rounded-xl shadow-binance-lg w-11/12 max-w-md border border-binance-border text-center">
                        <h1 className="text-3xl font-bold text-binance-text-light mb-6">{dapp} Details</h1>
                        <p className="text-binance-text-muted mb-6">
                            This page would display detailed information about {dapp}, including its description, supported networks, and a link to its interface.
                        </p>
                        <button
                            onClick={() => navigate('dappsPage')}
                            className="w-full px-6 py-3 bg-binance-accent-yellow text-binance-bg-primary font-semibold rounded-lg hover:opacity-90 transition-opacity duration-200"
                        >
                            Back to Discover DApps
                        </button>
                    </div>
                </div>
            );
        };

        // --- Main App Component ---
        const App = () => {
            const [isDarkMode, setIsDarkMode] = useState(() => {
                if (localStorage.getItem('theme')) {
                    return localStorage.getItem('theme') === 'dark';
                }
                return true;
            });

            const [userStatus, setUserStatus] = useState(() => {
                const savedUserStatus = sessionStorage.getItem('userStatus');
                let initialStatus = savedUserStatus ? JSON.parse(savedUserStatus) : { isLoggedIn: false, connectedWalletInfo: null, transactions: [] };

                // Ensure transactions array exists
                if (!initialStatus.transactions) {
                    initialStatus.transactions = [];
                }

                // Initialize detailedBalances and total USDT for new connections or if not present
                if (initialStatus.connectedWalletInfo && !initialStatus.connectedWalletInfo.detailedBalances) {
                    initialStatus.connectedWalletInfo.detailedBalances = {
                        BNB: '0.00 BNB', // Changed to 0.00
                        ETH: '0.00 ETH', // Changed to 0.00
                        BTC: '0.00 BTC', // Changed to 0.00
                        USDT: '5678.78 USDT' // Changed to 5678.78
                    };
                    initialStatus.connectedWalletInfo.balance = initialStatus.connectedWalletInfo.detailedBalances.USDT;
                } else if (!initialStatus.connectedWalletInfo) {
                    initialStatus.connectedWalletInfo = null;
                }

                // Handle persistent withdrawal state on app load
                const savedWithdrawal = localStorage.getItem('pendingWithdrawal'); // Use localStorage for better persistence
                if (savedWithdrawal) {
                    const parsedWithdrawal = JSON.parse(savedWithdrawal);
                    if (parsedWithdrawal.status === 'Processing') {
                        const currentTime = Date.now();
                        // If current time is past the estimated completion time, process it now
                        if (currentTime >= parsedWithdrawal.estimatedCompletionTime) {
                            // Deduct amount from balance
                            const asset = parsedWithdrawal.asset;
                            const amount = parsedWithdrawal.amount;
                            if (initialStatus.connectedWalletInfo && initialStatus.connectedWalletInfo.detailedBalances[asset]) {
                                let currentAmount = parseFloat(initialStatus.connectedWalletInfo.detailedBalances[asset].split(' ')[0]);
                                currentAmount -= amount;
                                initialStatus.connectedWalletInfo.detailedBalances[asset] = `${Math.max(0, currentAmount).toFixed(4)} ${asset}`;
                            }
                            // Update transaction status
                            const txIndex = initialStatus.transactions.findIndex(tx => tx.id === parsedWithdrawal.id);
                            if (txIndex !== -1) {
                                initialStatus.transactions[txIndex] = { ...initialStatus.transactions[txIndex], status: 'Completed', completionTime: currentTime };
                            }
                            // Clear pending withdrawal after processing
                            localStorage.removeItem('pendingWithdrawal');
                            // Set details for immediate success popup display
                            initialStatus.completedWithdrawalDetails = {
                                ...parsedWithdrawal,
                                status: 'Completed',
                                completionTime: currentTime
                            };
                            initialStatus.showSuccessPopup = true;

                        } else {
                            // Still processing, re-enable the processing modal for this withdrawal
                            initialStatus.pendingWithdrawalDetails = parsedWithdrawal;
                        }
                    } else {
                         localStorage.removeItem('pendingWithdrawal'); // Clear if status is not processing (e.g., already completed or error)
                    }
                }
                return initialStatus;
            });

            const [showDepositAddressesModal, setShowDepositAddressesModal] = useState(false);
            const [showWithdrawalModal, setShowWithdrawalModal] = useState(false);
            const [showWithdrawalProcessingModal, setShowWithdrawalProcessingModal] = useState(false);
            const [currentWithdrawalDetails, setCurrentWithdrawalDetails] = useState(null);
            const [showWithdrawalSuccessPopup, setShowWithdrawalSuccessPopup] = useState(false);
            const [showInstallButton, setShowInstallButton] = useState(false); // State to control install button visibility

            // Re-open processing modal if there's a pending withdrawal from previous session
            useEffect(() => {
                if (userStatus.pendingWithdrawalDetails) {
                    setCurrentWithdrawalDetails(userStatus.pendingWithdrawalDetails);
                    setShowWithdrawalProcessingModal(true);
                    // Clear it from userStatus after using it for the modal (don't clear from storage yet, as modal handles it)
                    setUserStatus(prev => {
                        const newState = { ...prev };
                        delete newState.pendingWithdrawalDetails;
                        return newState;
                    });
                }
                // Trigger success popup immediately if a withdrawal completed while offline
                if (userStatus.showSuccessPopup && userStatus.completedWithdrawalDetails) {
                    setCurrentWithdrawalDetails(userStatus.completedWithdrawalDetails);
                    setShowWithdrawalSuccessPopup(true);
                    setUserStatus(prev => {
                        const newState = { ...prev };
                        delete newState.completedWithdrawalDetails;
                        delete newState.showSuccessPopup;
                        return newState;
                    });
                }
            }, []); // Run only once on mount

            // Handle PWA installation
            useEffect(() => {
                const handleBeforeInstallPrompt = (e) => {
                    e.preventDefault();
                    deferredPrompt = e;
                    setShowInstallButton(true); // Show install button when prompt is available
                    console.log('beforeinstallprompt fired, deferredPrompt stored, install button shown.');
                };

                const handleAppInstalled = () => {
                    showModal('Binance Web3 Wallet PWA installed successfully!');
                    deferredPrompt = null;
                    setShowInstallButton(false); // Hide install button after installation
                    console.log('PWA was installed!');
                };

                window.addEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
                window.addEventListener('appinstalled', handleAppInstalled);

                // Initial check for installability on load
                if (deferredPrompt) {
                    setShowInstallButton(true);
                }

                return () => {
                    window.removeEventListener('beforeinstallprompt', handleBeforeInstallPrompt);
                    window.removeEventListener('appinstalled', handleAppInstalled);
                };
            }, []);

            const handleInstallClick = async () => {
                if (!deferredPrompt) {
                    showModal('App cannot be installed at this time or is already installed.');
                    return;
                }
                deferredPrompt.prompt(); // Show the install prompt
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the install prompt: ${outcome}`);
                deferredPrompt = null; // Clear prompt regardless of outcome
                setShowInstallButton(false); // Hide the button after prompt
            };

            // Determine if wallet is connected for dashboard access
            const isWalletConnected = !!userStatus.connectedWalletInfo;

            // Initial page logic: Landing page if no wallet connected, Wallet if wallet connected.
            const initialPage = isWalletConnected ? 'walletPage' : 'landingPage';
            const [history, setHistory] = useState(() => {
                const savedHistory = sessionStorage.getItem('appHistory');
                if (savedHistory) {
                    const parsedHistory = JSON.parse(savedHistory);
                    if (parsedHistory.length > 0) {
                        return parsedHistory;
                    }
                }
                return [{ page: initialPage, params: {} }];
            });
            const currentPage = history[history.length - 1].page;
            const currentPageParams = history[history.length - 1].params;

            useEffect(() => {
                sessionStorage.setItem('userStatus', JSON.stringify(userStatus));
                sessionStorage.setItem('appHistory', JSON.stringify(history));
            }, [userStatus, history]);

            const toggleDarkMode = useCallback(() => {
                setIsDarkMode(prevMode => {
                    const newMode = !prevMode;
                    localStorage.setItem('theme', newMode ? 'dark' : 'light');
                    return newMode;
                });
            }, []);

            useEffect(() => {
                if (isDarkMode) {
                    document.documentElement.classList.add('dark');
                    document.documentElement.classList.remove('light');
                } else {
                    document.documentElement.classList.remove('dark');
                    document.documentElement.classList.add('light');
                }
            }, [isDarkMode]);

            const handleInitiateWithdrawal = useCallback((details) => {
                // Ensure the transaction ID is unique and store startTime and estimatedCompletionTime
                const withdrawalTx = {
                    ...details,
                    id: Date.now(), // Unique ID for this transaction
                };

                setUserStatus(prevStatus => ({
                    ...prevStatus,
                    transactions: [...prevStatus.transactions, withdrawalTx]
                }));
                setCurrentWithdrawalDetails(withdrawalTx);
                setShowWithdrawalModal(false); // Close the withdrawal form modal
                setShowWithdrawalProcessingModal(true); // Open the processing modal

                // Persist pending withdrawal for offline tracking using localStorage for better persistence
                localStorage.setItem('pendingWithdrawal', JSON.stringify(withdrawalTx));
            }, []);

            const handleWithdrawalComplete = useCallback((completedDetails) => {
                setUserStatus(prevStatus => {
                    const updatedTransactions = prevStatus.transactions.map(tx =>
                        tx.id === completedDetails.id ? { ...tx, status: 'Completed', completionTime: Date.now() } : tx
                    );

                    // Deduct amount from balance for the withdrawn asset
                    const asset = completedDetails.asset;
                    const amount = completedDetails.amount;
                    const newDetailedBalances = { ...prevStatus.connectedWalletInfo.detailedBalances };

                    if (newDetailedBalances[asset]) {
                        let currentAmount = parseFloat(newDetailedBalances[asset].split(' ')[0]);
                        currentAmount -= amount;
                        // Ensure amount doesn't go below zero for display
                        newDetailedBalances[asset] = `${Math.max(0, currentAmount).toFixed(4)} ${asset}`;
                    }

                    const newConnectedWalletInfo = {
                        ...prevStatus.connectedWalletInfo,
                        detailedBalances: newDetailedBalances,
                        // No need to explicitly set `balance` here as `calculateTotalUSD` will re-evaluate
                        // If there's a primary balance field, it should be updated based on specific asset
                        // For this demo, we can just update the detailedBalances.
                    };

                    return {
                        ...prevStatus,
                        transactions: updatedTransactions,
                        connectedWalletInfo: newConnectedWalletInfo
                    };
                });
                setShowWithdrawalProcessingModal(false); // Close processing modal
                setShowWithdrawalSuccessPopup(true); // Show success popup
                setCurrentWithdrawalDetails(completedDetails); // Set details for success popup

                // Clear persistent state for this completed withdrawal
                localStorage.removeItem('pendingWithdrawal');
            }, []);

            const navigate = useCallback((pageName, params = {}) => {
                setHistory(prevHistory => {
                    // Access control: If wallet not connected, only allow navigation to landing or wallet connect or FAQ
                    // This prevents direct navigation to restricted pages without a connected wallet.
                    if (!isWalletConnected && pageName !== 'landingPage' && pageName !== 'walletConnectPage' && pageName !== 'faqPage') {
                        showModal('Please connect your wallet to access this feature.');
                        return [{ page: 'landingPage', params: {} }]; // Redirect to landing page
                    }

                    // This handles the user's specific request:
                    // If wallet is connected AND user tries to go to walletConnectPage from ANYWHERE other than landing,
                    // keep them on the walletPage (dashboard) instead of showing connect options again.
                    if (isWalletConnected && pageName === 'walletConnectPage' && prevHistory[prevHistory.length - 1].page !== 'landingPage') {
                        // User is already connected, trying to go to connect page from an internal page,
                        // so redirect them back to the wallet dashboard.
                        return [{ page: 'walletPage', params: {} }];
                    }

                    const existingIndex = prevHistory.findIndex(entry => entry.page === pageName && JSON.stringify(entry.params) === JSON.stringify(params));
                    if (existingIndex !== -1) {
                        return prevHistory.slice(0, existingIndex + 1);
                    }
                    return [...prevHistory, { page: pageName, params: params }];
                });
            }, [isWalletConnected]);

            const goBack = useCallback(() => {
                setHistory(prevHistory => {
                    if (prevHistory.length > 1) {
                        return prevHistory.slice(0, prevHistory.length - 1);
                    }
                    return prevHistory;
                });
            }, []);

            // Show back button logic: show if not on landing page AND not on wallet page
            const showBackButton = (currentPage !== 'landingPage' && currentPage !== 'walletPage');

            let PageComponent;
            switch (currentPage) {
                case 'landingPage':
                    PageComponent = <LandingPage navigate={navigate} showInstallButton={showInstallButton} handleInstallClick={handleInstallClick} />;
                    break;
                case 'walletPage':
                    PageComponent = <WalletPage navigate={navigate}
                                            openDepositModal={() => setShowDepositAddressesModal(true)}
                                            openWithdrawalModal={() => setShowWithdrawalModal(true)}
                                            isDarkMode={isDarkMode} />;
                    break;
                case 'loginPage':
                    PageComponent = <LoginPage navigate={navigate} setUserStatus={setUserStatus} />;
                    break;
                case 'walletConnectPage':
                    PageComponent = <WalletConnectPage navigate={navigate} setUserStatus={setUserStatus} />;
                    break;
                case 'connectedWalletDetails':
                    PageComponent = <ConnectedWalletDetailsPage navigate={navigate} setUserStatus={setUserStatus} />;
                    break;
                case 'tradePage':
                    PageComponent = <TradePage navigate={navigate} isDarkMode={isDarkMode} />;
                    break;
                case 'earnPage':
                    PageComponent = <EarnPage navigate={navigate} isDarkMode={isDarkMode} />;
                    break;
                case 'convertPage':
                    PageComponent = <ConvertPage navigate={navigate} isDarkMode={isDarkMode} />;
                    break;
                case 'swapPage':
                    PageComponent = <SwapPage navigate={navigate} isDarkMode={isDarkMode} />;
                    break;
                case 'transactionHistoryPage':
                    PageComponent = <TransactionHistoryPage navigate={navigate} />;
                    break;
                case 'faqPage':
                    PageComponent = <FAQPage navigate={navigate} />;
                    break;
                case 'settingsPage':
                    PageComponent = <SettingsPage navigate={navigate} />;
                    break;
                case 'securitySettingsPage':
                    PageComponent = <SecuritySettingsPage navigate={navigate} />;
                    break;
                case 'networkSettingsPage':
                    PageComponent = <NetworkSettingsPage navigate={navigate} />;
                    break;
                case 'preferencesPage':
                    PageComponent = <PreferencesPage navigate={navigate} />;
                    break;
                case 'aboutPage':
                    PageComponent = <AboutPage navigate={navigate} />;
                    break;
                // --- NEW PAGES ---
                case 'walletPortfolioPage':
                    PageComponent = <WalletPortfolioPage navigate={navigate} isDarkMode={isDarkMode} />;
                    break;
                case 'marketsPage':
                    PageComponent = <MarketsPage navigate={navigate} />;
                    break;
                case 'copyTradePage':
                    PageComponent = <CopyTradePage navigate={navigate} />;
                    break;
                case 'dappsPage':
                    PageComponent = <DappsPage navigate={navigate} />;
                    break;
                case 'dappDetailsPage':
                    PageComponent = <DAppDetailsPage navigate={navigate} params={currentPageParams} />;
                    break;
                case 'stakePage':
                    PageComponent = <StakePage navigate={navigate} />;
                    break;
                case 'registerPage':
                    PageComponent = <RegisterPage navigate={navigate} />;
                    break;
                case 'twoFaPage':
                    PageComponent = <TwoFaPage navigate={navigate} />;
                    break;
                case 'changePasswordPage':
                    PageComponent = <ChangePasswordPage navigate={navigate} />;
                    break;
                case 'privacyDashboardPage':
                    PageComponent = <PrivacyDashboardPage navigate={navigate} />;
                    break;
                case 'addCustomNetworkPage':
                    PageComponent = <AddCustomNetworkPage navigate={navigate} />;
                    break;
                case 'manageNetworksPage':
                    PageComponent = <ManageNetworksPage navigate={navigate} />;
                    break;
                case 'languageSettingsPage':
                    PageComponent = <LanguageSettingsPage navigate={navigate} />;
                    break;
                case 'currencyUnitSettingsPage':
                    PageComponent = <CurrencyUnitSettingsPage navigate={navigate} />;
                    break;
                case 'notificationSettingsPage':
                    PageComponent = <NotificationSettingsPage navigate={navigate} />;
                    break;
                case 'termsOfServicePage':
                    PageComponent = <TermsOfServicePage navigate={navigate} />;
                    break;
                case 'privacyPolicyPage':
                    PageComponent = <PrivacyPolicyPage navigate={navigate} />;
                    break;
                default:
                    PageComponent = <LandingPage navigate={navigate} showInstallButton={showInstallButton} handleInstallClick={handleInstallClick} />;
                    break;
            }

            return (
                <UserContext.Provider value={{ userStatus, setUserStatus }}>
                    <div className="min-h-screen bg-binance-bg-primary text-binance-text-light transition-colors duration-300">
                        <Header
                            toggleDarkMode={toggleDarkMode}
                            isDarkMode={isDarkMode}
                            navigate={navigate}
                            goBack={goBack}
                            showBackButton={showBackButton}
                            isLandingPage={currentPage === 'landingPage'}
                            showInstallButton={showInstallButton}
                            handleInstallClick={handleInstallClick}
                        />
                        <main className="min-h-[calc(100vh-160px)] md:min-h-[calc(100vh-80px)]">
                            {PageComponent}
                        </main>
                        {currentPage !== 'landingPage' && <Footer navigate={navigate} />}

                        {/* Modals */}
                        <Modal isOpen={showDepositAddressesModal} onClose={() => setShowDepositAddressesModal(false)} title="Deposit Funds">
                            <DepositPage onClose={() => setShowDepositAddressesModal(false)} />
                        </Modal>

                        <Modal isOpen={showWithdrawalModal} onClose={() => setShowWithdrawalModal(false)} title="Withdraw Funds">
                            <WithdrawPage onClose={() => setShowWithdrawalModal(false)} onInitiateWithdrawal={handleInitiateWithdrawal} />
                        </Modal>

                        <Modal isOpen={showWithdrawalProcessingModal} onClose={() => setShowWithdrawalProcessingModal(false)} title="Withdrawal Status">
                            {currentWithdrawalDetails && (
                                <WithdrawalProcessingPage
                                    withdrawalDetails={currentWithdrawalDetails}
                                    onClose={() => setShowWithdrawalProcessingModal(false)}
                                    onWithdrawalComplete={handleWithdrawalComplete}
                                />
                            )}
                        </Modal>

                        {showWithdrawalSuccessPopup && currentWithdrawalDetails && (
                            <Modal isOpen={showWithdrawalSuccessPopup} onClose={() => setShowWithdrawalSuccessPopup(false)} title="Withdrawal Complete">
                                <WithdrawalSuccessPage
                                    withdrawalDetails={currentWithdrawalDetails}
                                    onClose={() => setShowWithdrawalSuccessPopup(false)}
                                />
                            </Modal>
                        )}
                    </div>
                </UserContext.Provider>
            );
        };

        window.onload = function () {
            ReactDOM.createRoot(document.getElementById('root')).render(<App />);
        };
    </script>
</body>
</html>
